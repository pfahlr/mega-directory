<%- include('../partials/page-start', { title: 'SEO Field Editor', active: 'seo' }) %>
<section class="panel stack gap-md">
  <header class="panel-header">
    <div>
      <p class="eyebrow">SEO Toolkit</p>
      <h2>Category + location metadata</h2>
      <p class="muted">Refresh page titles and meta descriptions before publishing new directory pages.</p>
    </div>
    <div class="badge">Records <strong><%= totalEntries %></strong></div>
  </header>

  <% if (typeof savedCount === 'number') { %>
    <div class="alert success">Updated <strong><%= savedCount %></strong> SEO entr<%= savedCount === 1 ? 'y' : 'ies' %>.</div>
  <% } %>

  <% if (!categories.length && !categoryLocations.length) { %>
    <p class="empty-state">No SEO fields available yet.</p>
  <% } else { %>
    <form method="POST" action="/seo" class="stack gap-lg">
      <% if (categories.length) { %>
        <section class="stack gap-sm">
          <div class="section-heading">
            <h3>Category templates</h3>
            <p class="muted"><%= categories.length %> base categories</p>
          </div>
          <% categories.forEach((entry) => { %>
            <% const updatedLabel = new Date(entry.lastUpdated).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' }); %>
            <article class="seo-card stack gap-sm">
              <input type="hidden" name="entries[<%= entry.id %>][id]" value="<%= entry.id %>" />
              <header>
                <p class="eyebrow"><%= entry.category %></p>
                <p class="muted">Slug <strong><%= entry.slug %></strong> • Last edited <strong><%= updatedLabel %></strong></p>
              </header>
              <label class="field-label">Meta title
                <input class="field-control" type="text" name="entries[<%= entry.id %>][metaTitle]" value="<%= entry.metaTitle %>" />
              </label>
              <label class="field-label">Meta description
                <textarea class="field-control" name="entries[<%= entry.id %>][metaDescription]" rows="3"><%= entry.metaDescription %></textarea>
              </label>
            </article>
          <% }) %>
        </section>
      <% } %>

      <% if (categoryLocations.length) { %>
        <section class="stack gap-sm">
          <div class="section-heading">
            <h3>Category + location</h3>
            <p class="muted"><%= categoryLocations.length %> localized variants</p>
          </div>
          <% categoryLocations.forEach((entry) => { %>
            <% const updatedLabel = new Date(entry.lastUpdated).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' }); %>
            <article class="seo-card stack gap-sm">
              <input type="hidden" name="entries[<%= entry.id %>][id]" value="<%= entry.id %>" />
              <header>
                <p class="eyebrow"><%= entry.category %> • <%= entry.location %></p>
                <p class="muted">Slug <strong><%= entry.slug %></strong> • Last edited <strong><%= updatedLabel %></strong></p>
              </header>
              <label class="field-label">Meta title
                <input class="field-control" type="text" name="entries[<%= entry.id %>][metaTitle]" value="<%= entry.metaTitle %>" />
              </label>
              <label class="field-label">Meta description
                <textarea class="field-control" name="entries[<%= entry.id %>][metaDescription]" rows="3"><%= entry.metaDescription %></textarea>
              </label>
            </article>
          <% }) %>
        </section>
      <% } %>

      <div class="form-actions">
        <button type="submit" class="btn primary">Save SEO copy</button>
        <p class="muted">Changes are stored in memory until real API wiring is complete.</p>
      </div>
    </form>
  <% } %>
</section>
<%- include('../partials/page-end') %>
