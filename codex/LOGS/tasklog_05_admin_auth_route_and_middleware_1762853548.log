OpenAI Codex v0.57.0 (research preview)
--------
workdir: /var/home/rick/Development/mega-directory
model: gpt-5-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a7242-7273-7980-92b7-228efba0a708
--------
user
Implement the functionality described in codex/TASKS/05_admin_auth_route_and_middleware.yaml, then verify with any available tests.

thinking
**Opening instructions file**
exec
bash -lc ls in /var/home/rick/Development/mega-directory succeeded in 38ms:
admin
agents
AGENTS.md
api
astro
codex
codex.toml
codex.yaml
db
docker-compose.yml
docs
README.md

thinking
**Retrieving tasks file content**
exec
bash -lc 'cat codex/TASKS/05_admin_auth_route_and_middleware.yaml' in /var/home/rick/Development/mega-directory succeeded in 37ms:
id: 5
title: Admin Auth Route & Middleware
description: Protect admin endpoints using JWT. Setup route to authenticate and issue
  admin tokens.
dependencies:
- 2

thinking
**Exploring admin folder for context**
exec
bash -lc 'ls admin' in /var/home/rick/Development/mega-directory succeeded in 38ms:
index.js
package.json
routes
views

thinking
**Inspecting admin package entry point**
exec
bash -lc "sed -n '1,200p' admin/index.js" in /var/home/rick/Development/mega-directory succeeded in 38ms:
const express = require('express');
const app = express();
const port = process.env.PORT || 4000;

app.use(express.static('public'));
app.use(express.urlencoded({ extended: true }));
app.use(express.json());

app.set('view engine', 'ejs');
app.set('views', './views');

app.get('/', (req, res) => {
  res.redirect('/review');
});

app.use('/review', require('./routes/review'));

app.listen(port, () => {
  console.log(`Admin app listening at http://localhost:${port}`);
});

thinking
**Checking for admin auth implementation**
exec
bash -lc 'ls admin/routes' in /var/home/rick/Development/mega-directory succeeded in 38ms:
review.js

thinking
**Starting interaction**
exec
bash -lc "sed -n '1,200p' admin/routes/review.js" in /var/home/rick/Development/mega-directory succeeded in 39ms:
const express = require('express');
const router = express.Router();

router.get('/', async (req, res) => {
  const listings = []; // Placeholder: fetch from API or DB
  res.render('review', { listings });
});

module.exports = router;

thinking
**Checking for admin auth routes**
exec
bash -lc 'ls api' in /var/home/rick/Development/mega-directory succeeded in 38ms:
Dockerfile
index.js
node_modules
package.json
package-lock.json
test

thinking
**Opening index file**
exec
bash -lc "sed -n '1,200p' api/index.js" in /var/home/rick/Development/mega-directory succeeded in 39ms:
const express = require('express');
const jwt = require('jsonwebtoken');

const DEFAULT_PORT = 3001;
const DEFAULT_LISTING_STATUS = 'INACTIVE';
const MAX_SLUG_LENGTH = 80;

function resolveConfig(overrides = {}) {
  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
  const baseConfig = {
    port: overrides.port ?? envPort ?? DEFAULT_PORT,
    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
  };

  const missing = [];
  if (!baseConfig.adminJwtSecret) {

thinking
**Identifying admin route and auth needs**
exec
bash -lc 'ls api/test' in /var/home/rick/Development/mega-directory succeeded in 38ms:
server.test.js

thinking
**Opening test files**
exec
bash -lc "sed -n '1,200p' api/test/server.test.js" in /var/home/rick/Development/mega-directory succeeded in 38ms:
const test = require('node:test');
const assert = require('node:assert');
const jwt = require('jsonwebtoken');
const { createServer } = require('..');

const baseConfig = Object.freeze({
  adminJwtSecret: 'test-admin-secret',
  adminJwtIssuer: 'mega-directory',
  adminJwtAudience: 'admin',
  crawlerBearerToken: 'crawler-token'
});

function findRoute(app, method, path) {
  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
  const methodName = method.toLowerCase();
  return stack.find(
    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
  );
}


thinking
**Proceeding with task**
exec
bash -lc "sed -n '200,400p' api/test/server.test.js" in /var/home/rick/Development/mega-directory succeeded in 39ms:
      buildListingPayload({ title: 'Bright Builders', categorySlug: 'builders' }),
      buildListingPayload({ title: 'Northern Lights', categorySlug: 'photographers', slug: null })
    ]
  };
  const req = createRequest({
    method: 'POST',
    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` },
    body: payload
  });
  const res = runRoute(route, req, createResponse());

  assert.strictEqual(res.statusCode, 202);
  assert.strictEqual(res.body.ingestedCount, 2);
  assert.strictEqual(res.body.ingested[0].title, 'Bright Builders');
  assert.strictEqual(res.body.ingested[0].slug, 'bright-builders');
  assert.strictEqual(res.body.ingested[1].slug, 'northern-lights');
  assert.ok(Date.parse(res.body.ingested[1].ingestedAt));

  const records = app.locals.ingestionStore.all();
  assert.strictEqual(records.length, 2);

thinking
**Planning admin auth implementation**
exec
bash -lc 'rg -n "admin auth" -n' in /var/home/rick/Development/mega-directory succeeded in 44ms:
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:78:**Checking for admin auth implementation**
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:98:**Checking for admin auth routes**
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:190:**Planning admin auth implementation**
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:192:bash -lc 'rg -n "admin auth" -n' in /var/home/rick/Development/mega-directory
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:223:Iâ€™m outlining the features and routes for an Express API server with JWT-based admin authentication and bearer token checks for crawler access. Iâ€™m considering environment variables, middleware, placeholder routes, and a test-driven approach using vitest and supertest before implementing the actual server logic.

thinking
**Checking for instructions in log file**
exec
bash -lc "sed -n '1,200p' codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log" in /var/home/rick/Development/mega-directory succeeded in 38ms:
OpenAI Codex v0.57.0 (research preview)
--------
workdir: /var/home/rick/Development/mega-directory
model: gpt-5-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a7242-7273-7980-92b7-228efba0a708
--------
user
Implement the functionality described in codex/TASKS/05_admin_auth_route_and_middleware.yaml, then verify with any available tests.

thinking
**Opening instructions file**
exec
bash -lc ls in /var/home/rick/Development/mega-directory succeeded in 38ms:
admin
agents

thinking
**Pausing to review more information**
exec
bash -lc "sed -n '200,400p' codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log" in /var/home/rick/Development/mega-directory succeeded in 38ms:
**Checking for instructions in log file**
exec
bash -lc "sed -n '1,200p' codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log" in /var/home/rick/Development/mega-directory succeeded in 38ms:
OpenAI Codex v0.57.0 (research preview)
--------
workdir: /var/home/rick/Development/mega-directory
model: gpt-5-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a7242-7273-7980-92b7-228efba0a708
--------
user
Implement the functionality described in codex/TASKS/05_admin_auth_route_and_middleware.yaml, then verify with any available tests.

thinking
**Opening instructions file**
exec

thinking
**Searching for admin token mentions**
exec
bash -lc 'rg -n "admin token" -n' in /var/home/rick/Development/mega-directory succeeded in 43ms:
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:39:  admin tokens.
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:250:**Searching for admin token mentions**
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:252:bash -lc 'rg -n "admin token" -n' in /var/home/rick/Development/mega-directory
codex/TASKS/05_admin_auth_route_and_middleware.yaml:4:  admin tokens.

thinking
**Searching for admin auth instructions**
exec
bash -lc 'rg -n "admin" api -n' in /var/home/rick/Development/mega-directory succeeded in 44ms:
api/test/server.test.js:7:  adminJwtSecret: 'test-admin-secret',
api/test/server.test.js:8:  adminJwtIssuer: 'mega-directory',
api/test/server.test.js:9:  adminJwtAudience: 'admin',
api/test/server.test.js:100:test('admin ping rejects missing token', () => {
api/test/server.test.js:102:  const route = findRoute(app, 'get', '/v1/admin/ping');
api/test/server.test.js:109:test('admin ping accepts valid JWT', () => {
api/test/server.test.js:111:  const route = findRoute(app, 'get', '/v1/admin/ping');
api/test/server.test.js:113:    { role: 'admin' },
api/test/server.test.js:114:    baseConfig.adminJwtSecret,
api/test/server.test.js:115:    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
api/test/server.test.js:124:  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
api/test/server.test.js:125:  assert.strictEqual(req.admin.role, 'admin');
api/test/server.test.js:256:    createServer({ adminJwtSecret: 'only-admin' });
api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
api/index.js:20:  if (!baseConfig.adminJwtSecret) {
api/index.js:47:  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
api/index.js:48:    res.json({ status: 'admin-ok' });
api/index.js:91:      const payload = jwt.verify(token, config.adminJwtSecret, {

thinking
**Searching for ADMIN_JWT references**
exec
bash -lc 'rg -n "ADMIN_JWT" -n' in /var/home/rick/Development/mega-directory succeeded in 45ms:
api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
api/index.js:21:    missing.push('ADMIN_JWT_SECRET');
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:124:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:125:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:126:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:275:api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:276:api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:277:api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:284:**Searching for ADMIN_JWT references**
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:286:bash -lc 'rg -n "ADMIN_JWT" -n' in /var/home/rick/Development/mega-directory
codex/LOGS/tasklog_04_implement_listing_ingestion_api_endpoint_1762853214.log:69:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_04_implement_listing_ingestion_api_endpoint_1762853214.log:70:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_04_implement_listing_ingestion_api_endpoint_1762853214.log:71:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_04_implement_listing_ingestion_api_endpoint_1762853214.log:77:    missing.push('ADMIN_JWT_SECRET');
codex/LOGS/tasklog_04_implement_listing_ingestion_api_endpoint_1762853214.log:2857:    13	    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_04_implement_listing_ingestion_api_endpoint_1762853214.log:2858:    14	    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_04_implement_listing_ingestion_api_endpoint_1762853214.log:2859:    15	    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_03_design_postgresql_schema_1762852701.log:269:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,

thinking
**Searching docs for admin auth**
exec
bash -lc 'rg -n "admin" docs -n' in /var/home/rick/Development/mega-directory succeeded in 41ms:
docs/AGENTS.md:39:* Authentication (token-based or admin login)
docs/AGENTS.md:77:Serve listings to the frontend, receive data from crawler, and power the admin interface.
docs/AGENTS.md:89:* Manage admin APIs for listing approval and SEO editing

thinking
**Searching README for JWT**
exec
bash -lc 'rg -n "JWT" -n' in /var/home/rick/Development/mega-directory succeeded in 42ms:
AGENTS.md:83:* JWT and API token auth
docs/AGENTS.md:83:* JWT and API token auth
api/test/server.test.js:109:test('admin ping accepts valid JWT', () => {
api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
api/index.js:21:    missing.push('ADMIN_JWT_SECRET');
README.md:8:- âš¡ Express API with JWT-based auth
README.md:44:Provide an `.env` file for the API service (e.g., JWT secrets, database URLs) before running Compose. Postgres data is stored in the `pgdata` volume declared in the compose file.
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:38:description: Protect admin endpoints using JWT. Setup route to authenticate and issue
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:124:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:125:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:126:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:197:codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:223:Iâ€™m outlining the features and routes for an Express API server with JWT-based admin authentication and bearer token checks for crawler access. Iâ€™m considering environment variables, middleware, placeholder routes, and a test-driven approach using vitest and supertest before implementing the actual server logic.
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:267:api/test/server.test.js:109:test('admin ping accepts valid JWT', () => {
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:275:api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:276:api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:277:api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:284:**Searching for ADMIN_JWT references**
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:286:bash -lc 'rg -n "ADMIN_JWT" -n' in /var/home/rick/Development/mega-directory succeeded in 45ms:

thinking
**Exploring task files in codex**
exec
bash -lc 'ls codex/TASKS' in /var/home/rick/Development/mega-directory succeeded in 38ms:
00_prepare_repository.yaml
01_initialize_astro_frontend.yaml
02_setup_api_server_with_express_and_jwt_auth.yaml
03_design_postgresql_schema.yaml
04_implement_listing_ingestion_api_endpoint.yaml
05_admin_auth_route_and_middleware.yaml
06_frontend_directory_page_rendering.yaml
07_frontend_subcategory_ui_and_layout.yaml
08_setup_featured_listings_logic.yaml
09_add_category_meta_and_seo_controls.yaml
10_scaffold_python_crawler_agent.yaml
11_llm_field_generation_via_jinja2.yaml
12_post_listings_from_crawler_to_api_server.yaml
13_create_json_crawler_configuration_schema.yaml
14_scaffold_admin_ui_application.yaml
15_admin_ui:_listing_review_table.yaml
16_admin_ui:_category_location_approval.yaml
17_admin_ui:_seo_field_editor.yaml
18_deploy_web_+_api_to_railway.yaml
19_setup_logging,_healthchecks_and_monitoring.yaml

thinking
**Planning to check file 02**
exec
bash -lc 'cat codex/TASKS/02_setup_api_server_with_express_and_jwt_auth.yaml' in /var/home/rick/Development/mega-directory succeeded in 38ms:
id: 2
title: Setup API Server with Express and JWT Auth
description: Create a Node.js Express API server with JWT-based authentication for
  admin access and a bearer token for crawler communication.
dependencies: []

thinking
**Investigating admin authentication requirements**
exec
bash -lc 'rg -n "v1/admin" -n -g"*"' in /var/home/rick/Development/mega-directory succeeded in 8.85s:
api/test/server.test.js:102:  const route = findRoute(app, 'get', '/v1/admin/ping');
api/test/server.test.js:111:  const route = findRoute(app, 'get', '/v1/admin/ping');
api/index.js:47:  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:266:api/test/server.test.js:102:  const route = findRoute(app, 'get', '/v1/admin/ping');
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:268:api/test/server.test.js:111:  const route = findRoute(app, 'get', '/v1/admin/ping');
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:279:api/index.js:47:  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:379:bash -lc 'rg -n "v1/admin" -n -g"*"' in /var/home/rick/Development/mega-directory
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:404:  const result = await makeRequest(app, { path: '/v1/admin/ping' });
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:418:    path: '/v1/admin/ping',
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:517:+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:531:+    path: '/v1/admin/ping',
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:628:+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:642:+    path: '/v1/admin/ping',
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:776:+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:790:+    path: '/v1/admin/ping',
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:905:+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:919:+    path: '/v1/admin/ping',
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:1042:+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:1056:+    path: '/v1/admin/ping',
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:1196:+  const result = await makeRequest(app, { path: '/v1/admin/ping' });

thinking
**Requesting additional route details**
exec
bash -lc "sed -n '1,200p' codex/CODEX_TODO.md" in /var/home/rick/Development/mega-directory exited 2 in 90ms:
sed: can't read codex/CODEX_TODO.md: No such file or directory

thinking
**Checking task file path**
exec
bash -lc "sed -n '1,200p' codex/TASKS/CODEX_TODO.md" in /var/home/rick/Development/mega-directory succeeded in 38ms:
# CODEX TODO

This document lists the Codex tasks in their recommended execution order.
Each task corresponds to a YAML file under `/codex/TASKS/`.

---

## 00 - Repository Setup

- [ ] 00_prepare_repository.yaml â€” Prepare the repository structure, move directories into place, update README and docker-compose config.

---

## 01â€“05 - Core Scaffolding

- [ ] 01_initialize_astro_frontend.yaml â€” Scaffold the Astro SSR frontend site.
- [ ] 02_initialize_api_server.yaml â€” Set up the Express/PostgreSQL API server with base routing and JWT auth.
- [ ] 03_initialize_database_schema.yaml â€” Define and migrate core tables: listings, categories, locations, directory.
- [ ] 04_initialize_admin_app.yaml â€” Scaffold a separate admin web interface with basic routing and layout.
- [ ] 05_initialize_python_crawler.yaml â€” Bootstrap the external Python-based crawler project with config loading and CLI entrypoint.

thinking
**Assessing task details and authentication setup**
exec
bash -lc 'rg -n "ADMIN_" -n' in /var/home/rick/Development/mega-directory succeeded in 42ms:
api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
api/index.js:21:    missing.push('ADMIN_JWT_SECRET');
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:124:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:125:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:126:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:275:api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:276:api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:277:api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:284:**Searching for ADMIN_JWT references**
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:286:bash -lc 'rg -n "ADMIN_JWT" -n' in /var/home/rick/Development/mega-directory succeeded in 45ms:
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:287:api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:288:api/index.js:14:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:289:api/index.js:15:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:290:api/index.js:21:    missing.push('ADMIN_JWT_SECRET');
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:291:codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:124:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:292:codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:125:    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:293:codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:126:    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:294:codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:275:api/index.js:13:    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,

thinking
**Checking admin credentials setup**
exec
bash -lc 'rg -n "PASSWORD" -n' in /var/home/rick/Development/mega-directory succeeded in 42ms:
docker-compose.yml:35:      POSTGRES_PASSWORD: password
codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:460:bash -lc 'rg -n "PASSWORD" -n' in /var/home/rick/Development/mega-directory

thinking
**Investigating admin authentication setup**
exec
bash -lc "sed -n '400,800p' codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log" in /var/home/rick/Development/mega-directory succeeded in 38ms:

thinking
**Requesting additional route details**
exec
bash -lc "sed -n '1,200p' codex/CODEX_TODO.md" in /var/home/rick/Development/mega-directory exited 2 in 90ms:
sed: can't read codex/CODEX_TODO.md: No such file or directory

thinking
**Checking task file path**
exec
bash -lc "sed -n '1,200p' codex/TASKS/CODEX_TODO.md" in /var/home/rick/Development/mega-directory succeeded in 38ms:
# CODEX TODO

This document lists the Codex tasks in their recommended execution order.
Each task corresponds to a YAML file under `/codex/TASKS/`.

---

## 00 - Repository Setup


thinking
**Investigating admin authentication setup**
exec
bash -lc "sed -n '1,200p' README.md" in /var/home/rick/Development/mega-directory succeeded in 40ms:
# Mega Directory

Mega Directory is a server-rendered directory listing platform built with Astro, Express, and Prisma. It supports dynamic subdomains, AI-generated content enrichment, and moderation workflows.

## Features

- ğŸ›°ï¸ Subdomain-based regional directories (e.g. electricians.nyc.example.com)
- âš¡ Express API with JWT-based auth
- ğŸ§  AI agents for crawling, enrichment, and moderation (via OpenRouter)
- ğŸ§© Admin dashboard for approving or rejecting listings
- ğŸ’… Tailwind CSS and minimal JavaScript for accessibility and performance
- ğŸ³ Dockerized and deployable behind Cloudflare with SSR

## Tech Stack

- Astro (SSR)
- Express.js
- Prisma + PostgreSQL
- Tailwind CSS
- OpenRouter (AI Agents)

thinking
**Designing admin auth route**
exec
bash -lc "sed -n '1,200p' docker-compose.yml" in /var/home/rick/Development/mega-directory succeeded in 40ms:
version: '3.8'

services:
  api:
    build:
      context: ./api
    ports:
      - "3001:3001"
    env_file:
      - ./api/.env
    depends_on:
      - db
    volumes:
      - ./api:/app

  astro:
    build:
      context: ./astro
    ports:
      - "3000:3000"

thinking
**Searching for environment variable examples**
exec
bash -lc 'rg --files -g "*.env"' in /var/home/rick/Development/mega-directory exited 1 in 42ms:


thinking
**Checking codex.yaml**
exec
bash -lc 'cat codex.yaml' in /var/home/rick/Development/mega-directory succeeded in 37ms:
version: 1
tasks:
  - id: '00'
    path: codex/TASKS/00_prepare_repository.yaml
  - id: '01'
    path: codex/TASKS/01_initialize_astro_frontend.yaml
  - id: '02'
    path: codex/TASKS/02_setup_api_server_with_express_and_jwt_auth.yaml
  - id: '03'
    path: codex/TASKS/03_design_postgresql_schema.yaml
  - id: '04'
    path: codex/TASKS/04_implement_listing_ingestion_api_endpoint.yaml
  - id: '05'
    path: codex/TASKS/05_admin_auth_route_&_middleware.yaml
  - id: '06'
    path: codex/TASKS/06_frontend_directory_page_rendering.yaml
  - id: '07'
    path: codex/TASKS/07_frontend_subcategory_ui_&_layout.yaml
  - id: '08'
    path: codex/TASKS/08_setup_featured_listings_logic.yaml

thinking
**Checking task file location**
exec
bash -lc 'cat codex/work_list' in /var/home/rick/Development/mega-directory exited 1 in 41ms:
cat: codex/work_list: No such file or directory

thinking
**Correcting task file path**
exec
bash -lc 'cat codex/TASKS/work_list' in /var/home/rick/Development/mega-directory succeeded in 37ms:
04_implement_listing_ingestion_api_endpoint.yaml
05_admin_auth_route_and_middleware.yaml
23_docker_compose_local_dev.yaml
06_frontend_directory_page_rendering.yaml
07_frontend_subcategory_ui_and_layout.yaml
08_setup_featured_listings_logic.yaml
09_add_category_meta_and_seo_controls.yaml
10_scaffold_python_crawler_agent.yaml
11_llm_field_generation_via_jinja2.yaml
12_post_listings_from_crawler_to_api_server.yaml
13_create_json_crawler_configuration_schema.yaml
14_scaffold_admin_ui_application.yaml

thinking
**Searching documentation for instructions**
exec
bash -lc 'rg -n "auth" -g"*.md"' in /var/home/rick/Development/mega-directory succeeded in 47ms:
AGENTS.md:83:* JWT and API token auth
docs/AGENTS.md:83:* JWT and API token auth
README.md:8:- âš¡ Express API with JWT-based auth
codex/TASKS/CODEX_TODO.md:17:- [ ] 02_initialize_api_server.yaml â€” Set up the Express/PostgreSQL API server with base routing and JWT auth.
codex/TASKS/CODEX_TODO.md:28:- [ ] 08_api_token_auth.yaml â€” Implement token-based auth for crawler/Admin access to secured endpoints.

thinking
**Planning admin auth route and tests**

Iâ€™m working out how to implement a new admin authentication route with JWT protection, balancing instructions and missing details. Iâ€™ll probably add test-driven development with tests in `api/test/server.test.js` and design a `POST /v1/admin/auth` route that verifies admin credentials from environment variables before issuing tokens. Since credential config is unclear, Iâ€™m considering options like `ADMIN_EMAIL` and `ADMIN_PASSCODE` for verification or defining new env variables for this purpose. Iâ€™m curious if existing secrets like `adminJwtSecret` fit in, and I might also search logs for previous hints on admin auth routes to clarify. Letâ€™s explore this thoughtfully!
exec
bash -lc 'rg -n "auth route" codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log' in /var/home/rick/Development/mega-directory succeeded in 41ms:
98:**Checking for admin auth routes**
194:codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log:98:**Checking for admin auth routes**
515:**Designing admin auth route**
604:**Planning admin auth route and tests**
606:Iâ€™m working out how to implement a new admin authentication route with JWT protection, balancing instructions and missing details. Iâ€™ll probably add test-driven development with tests in `api/test/server.test.js` and design a `POST /v1/admin/auth` route that verifies admin credentials from environment variables before issuing tokens. Since credential config is unclear, Iâ€™m considering options like `ADMIN_EMAIL` and `ADMIN_PASSCODE` for verification or defining new env variables for this purpose. Iâ€™m curious if existing secrets like `adminJwtSecret` fit in, and I might also search logs for previous hints on admin auth routes to clarify. Letâ€™s explore this thoughtfully!
608:bash -lc 'rg -n "auth route" codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log' in /var/home/rick/Development/mega-directory

thinking
**Checking admin auth route notes**
exec
bash -lc "sed -n '500,700p' codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log" in /var/home/rick/Development/mega-directory succeeded in 41ms:
- âš¡ Express API with JWT-based auth
- ğŸ§  AI agents for crawling, enrichment, and moderation (via OpenRouter)
- ğŸ§© Admin dashboard for approving or rejecting listings
- ğŸ’… Tailwind CSS and minimal JavaScript for accessibility and performance
- ğŸ³ Dockerized and deployable behind Cloudflare with SSR

## Tech Stack

- Astro (SSR)
- Express.js
- Prisma + PostgreSQL
- Tailwind CSS
- OpenRouter (AI Agents)

thinking
**Designing admin auth route**
exec
bash -lc "sed -n '1,200p' docker-compose.yml" in /var/home/rick/Development/mega-directory succeeded in 40ms:
version: '3.8'


thinking
**Reviewing credential plan notes**
exec
bash -lc "sed -n '700,1000p' codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log" in /var/home/rick/Development/mega-directory succeeded in 41ms:


thinking
**Designing admin authentication route and config updates**

I'm outlining a new POST route `/v1/admin/auth` which accepts JSON with email and passcode, validates them against config env variables, and issues a JWT on success. I'll need to update config resolution to require `ADMIN_LOGIN_EMAIL` and `ADMIN_LOGIN_PASSCODE`, modify tests accordingly, and add thorough tests for error cases and token issuance. Since this is a multi-step task touching tests, config, the route, and token validation, I'll create a plan to organize these steps.
Plan update
Implementing a new admin authentication route requires tests first, then the route/middleware and verification via the existing test suite.
  â†’ Add server tests that describe the admin auth route behavior and its interaction with the middleware.
  â€¢ Update the API server to expose the auth route, validate credentials from config, and return signed JWTs.
  â€¢ Run the API test suite to verify the implementation.

thinking
**Adding admin authentication tests**

I'll add tests for the new admin auth route in `api/test/server.test.js`, covering missing credentials, invalid credentials, and successful login issuing a JWT. Iâ€™ll update `baseConfig` with admin login fields and ensure the tests verify token validity and access to admin-only routes like ping. Iâ€™ll also confirm how to run tests via `npm test` in the API directory.
exec
bash -lc 'cat api/package.json' in /var/home/rick/Development/mega-directory succeeded in 89ms:
{
  "name": "mega-directory-api",
  "private": true,
  "version": "0.1.0",
  "main": "index.js",
  "scripts": {
    "dev": "node index.js",
    "start": "node index.js",
    "test": "node --test"
  },
  "dependencies": {
    "express": "^4.19.2",
    "jsonwebtoken": "^9.0.2"
  }
}

thinking
**Preparing to patch server tests**
file update
M /var/home/rick/Development/mega-directory/api/test/server.test.js
@@ -9,2 +9,4 @@
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
@@ -127,2 +129,69 @@
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
apply_patch(auto_approved=true) exited 0 in 5ms:
Success. Updated the following files:
M api/test/server.test.js
file update:
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');

file update:
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Verifying implementation requirements**
Plan update
  âœ“ Add server tests that describe the admin auth route behavior and its interaction with the middleware.
  â†’ Update the API server to expose the auth route, validate credentials from config, and return signed JWTs.
  â€¢ Run the API test suite to verify the implementation.
file update:
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Implementing admin auth route and config**
exec
bash -lc "sed -n '200,400p' api/index.js" in /var/home/rick/Development/mega-directory succeeded in 53ms:
  if (!slug) {
    errors.push('slug is required or must be derivable from title');
  }

  const categorySlugInput = sanitizeNullableString(payload.categorySlug);
  const categorySlug = categorySlugInput ? slugify(categorySlugInput) : '';
  if (!categorySlug) {
    errors.push('categorySlug is required');
  }

  const websiteUrl = optionalUrl(payload.websiteUrl, 'websiteUrl', errors);
  const sourceUrl = optionalUrl(payload.sourceUrl, 'sourceUrl', errors);
  const contactEmail = optionalEmail(payload.contactEmail, 'contactEmail', errors);
  const summary = sanitizeNullableString(payload.summary);
  const tagline = sanitizeNullableString(payload.tagline);
  const notes = sanitizeNullableString(payload.notes);
  const sourceName = sanitizeNullableString(payload.sourceName);
  const location = sanitizeLocation(payload.location);

  if (errors.length > 0) {
file update:
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Planning integration and configuration updates**
exec
bash -lc "sed -n '1,120p' api/index.js" in /var/home/rick/Development/mega-directory succeeded in 39ms:
const express = require('express');
const jwt = require('jsonwebtoken');

const DEFAULT_PORT = 3001;
const DEFAULT_LISTING_STATUS = 'INACTIVE';
const MAX_SLUG_LENGTH = 80;

function resolveConfig(overrides = {}) {
  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
  const baseConfig = {
    port: overrides.port ?? envPort ?? DEFAULT_PORT,
    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
  };

  const missing = [];
  if (!baseConfig.adminJwtSecret) {
file update:
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Adding admin auth route and handler**

I'm preparing to insert a new POST route for admin authentication in the API, defining `createAdminAuthHandler` to validate credentials from the request body against config values, issue a JWT token with proper expiration, and handle errors like missing fields or misconfiguration. I'll carefully parse config and environment variables for email, passcode, and token TTL, ensuring defaults and validations are solid to prevent issues. This involves modifying multiple parts of the API initialization to integrate these settings properly.
file update
M /var/home/rick/Development/mega-directory/api/index.js
@@ -6,2 +6,3 @@
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
@@ -10,2 +11,8 @@
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
@@ -15,3 +22,17 @@
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
@@ -22,2 +43,8 @@
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
@@ -46,2 +73,4 @@
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
@@ -113,2 +142,54 @@
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
apply_patch(auto_approved=true) exited 0 in 14ms:
Success. Updated the following files:
M api/index.js
file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');

file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Ensuring robust admin token TTL parsing**

I'm thinking through how to handle admin token TTL values that might come as strings or numbers in overrides or environment variables. It looks like converting override inputs to numbers before checking if they're finite is the safest way to avoid fallback issues. Iâ€™m also double-checking that related functions like `createAdminAuthHandler` correctly use helpers like `isPlainObject`, and verifying the API route ordering and test setup before running tests. Let's make sure all these details are handled properly.
exec
bash -lc 'npm test' in /var/home/rick/Development/mega-directory/api succeeded in 950ms:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# Subtest: test/server.test.js
ok 1 - test/server.test.js
  ---
  duration_ms: 473.38703
  type: 'test'
  ...
1..1
# tests 1
# suites 0
# pass 1
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 494.06934
file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Updating plan statuses**
Plan update
  âœ“ Add server tests that describe the admin auth route behavior and its interaction with the middleware.
  âœ“ Update the API server to expose the auth route, validate credentials from config, and return signed JWTs.
  âœ“ Run the API test suite to verify the implementation.
file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Preparing git diff summary**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/mega-directory succeeded in 42ms:
## main...origin/main
 M api/index.js
 M api/test/server.test.js
 M codex/LOGS/tasklog_05_admin_auth_route_and_middleware_1762853548.log
?? codex/TASKS/work_list
file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Analyzing modified files and line numbers**
exec
bash -lc "nl -ba api/index.js | sed -n '1,200p'" in /var/home/rick/Development/mega-directory succeeded in 41ms:
     1	const express = require('express');
     2	const jwt = require('jsonwebtoken');
     3	
     4	const DEFAULT_PORT = 3001;
     5	const DEFAULT_LISTING_STATUS = 'INACTIVE';
     6	const MAX_SLUG_LENGTH = 80;
     7	const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
     8	
     9	function resolveConfig(overrides = {}) {
    10	  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
    11	  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
    12	  const parsedAdminTokenTtl =
    13	    overrides.adminTokenTtlSeconds ??
    14	    (process.env.ADMIN_TOKEN_TTL_SECONDS
    15	      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
    16	      : undefined);
    17	
    18	  const baseConfig = {
    19	    port: overrides.port ?? envPort ?? DEFAULT_PORT,
    20	    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Recording line numbers for tests**
exec
bash -lc "nl -ba api/test/server.test.js | sed -n '1,220p'" in /var/home/rick/Development/mega-directory succeeded in 43ms:
     1	const test = require('node:test');
     2	const assert = require('node:assert');
     3	const jwt = require('jsonwebtoken');
     4	const { createServer } = require('..');
     5	
     6	const baseConfig = Object.freeze({
     7	  adminJwtSecret: 'test-admin-secret',
     8	  adminJwtIssuer: 'mega-directory',
     9	  adminJwtAudience: 'admin',
    10	  adminLoginEmail: 'admin@example.com',
    11	  adminLoginPasscode: 'letmein',
    12	  crawlerBearerToken: 'crawler-token'
    13	});
    14	
    15	function findRoute(app, method, path) {
    16	  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
    17	  const methodName = method.toLowerCase();
    18	  return stack.find(
    19	    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
    20	  );
file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');


thinking
**Finalizing code change summary**
codex
Added the missing credential-backed admin auth flow so protected routes can be exercised end-to-end.

**Admin Auth**
- Required login email/passcode plus token TTL handling inside `resolveConfig`, so missing env values fail fast before the server starts (`api/index.js:18`, `api/index.js:34`, `api/index.js:40`).
- Registered `POST /v1/admin/auth` and implemented `createAdminAuthHandler` to validate credentials, issue 15â€‘minute JWTs, and return metadata for callers (`api/index.js:74`, `api/index.js:143`).

**Tests**
- `npm test` (from `api/`)

**Next Steps**
- Set `ADMIN_LOGIN_EMAIL`, `ADMIN_LOGIN_PASSCODE`, and optionally `ADMIN_TOKEN_TTL_SECONDS` in the API environment so the new auth route can operate with real credentials.
file update:
diff --git a/api/index.js b/api/index.js
index bb36d69040d50d969fcb5a8b7b3af1d6336779ab..b8b17f11d459d0dc2f538955e1ec16a983fd2f52
--- a/api/index.js
+++ b/api/index.js
@@ -4,22 +4,49 @@
 const DEFAULT_PORT = 3001;
 const DEFAULT_LISTING_STATUS = 'INACTIVE';
 const MAX_SLUG_LENGTH = 80;
+const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;
 
 function resolveConfig(overrides = {}) {
   const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const parsedAdminTokenTtl =
+    overrides.adminTokenTtlSeconds ??
+    (process.env.ADMIN_TOKEN_TTL_SECONDS
+      ? parseInt(process.env.ADMIN_TOKEN_TTL_SECONDS, 10)
+      : undefined);
+
   const baseConfig = {
     port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
     adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
     adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
-    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN,
+    adminLoginEmail:
+      overrides.adminLoginEmail ??
+      process.env.ADMIN_LOGIN_EMAIL ??
+      process.env.ADMIN_EMAIL ??
+      null,
+    adminLoginPasscode:
+      overrides.adminLoginPasscode ??
+      process.env.ADMIN_LOGIN_PASSCODE ??
+      process.env.ADMIN_PASSCODE ??
+      null,
+    adminTokenTtlSeconds:
+      Number.isFinite(parsedAdminTokenTtl) && parsedAdminTokenTtl > 0
+        ? parsedAdminTokenTtl
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS
   };
 
   const missing = [];
   if (!baseConfig.adminJwtSecret) {
     missing.push('ADMIN_JWT_SECRET');
   }
+  if (!baseConfig.adminLoginEmail) {
+    missing.push('ADMIN_LOGIN_EMAIL');
+  }
+  if (!baseConfig.adminLoginPasscode) {
+    missing.push('ADMIN_LOGIN_PASSCODE');
+  }
   if (!baseConfig.crawlerBearerToken) {
     missing.push('CRAWLER_BEARER_TOKEN');
   }
@@ -44,6 +71,8 @@
     res.json({ status: 'ok' });
   });
 
+  app.post('/v1/admin/auth', createAdminAuthHandler(config));
+
   app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
     res.json({ status: 'admin-ok' });
   });
@@ -111,6 +140,58 @@
   };
 }
 
+function createAdminAuthHandler(config) {
+  return (req, res) => {
+    const body = isPlainObject(req.body) ? req.body : {};
+    const email = sanitizeNullableString(body.email);
+    const passcode = typeof body.passcode === 'string' ? body.passcode : null;
+    const errors = [];
+
+    if (!email) {
+      errors.push('email is required');
+    }
+    if (!passcode) {
+      errors.push('passcode is required');
+    }
+    if (errors.length > 0) {
+      return res.status(400).json({ error: 'Invalid admin credentials', details: errors });
+    }
+
+    const expectedEmail = (sanitizeNullableString(config.adminLoginEmail) || '').toLowerCase();
+    const normalizedEmail = email.toLowerCase();
+    const expectedPasscode = config.adminLoginPasscode;
+
+    if (!expectedEmail || !expectedPasscode) {
+      return res.status(500).json({ error: 'Admin authentication is not configured' });
+    }
+
+    if (normalizedEmail !== expectedEmail || passcode !== expectedPasscode) {
+      return res.status(401).json({ error: 'Invalid admin credentials' });
+    }
+
+    const expiresIn =
+      Number.isFinite(config.adminTokenTtlSeconds) && config.adminTokenTtlSeconds > 0
+        ? config.adminTokenTtlSeconds
+        : DEFAULT_ADMIN_TOKEN_TTL_SECONDS;
+
+    const token = jwt.sign(
+      { sub: normalizedEmail, role: 'admin', type: 'access' },
+      config.adminJwtSecret,
+      {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience,
+        expiresIn
+      }
+    );
+
+    return res.json({
+      token,
+      tokenType: 'Bearer',
+      expiresIn
+    });
+  };
+}
+
 function startServer() {
   const app = createServer();
   const { port } = app.locals.config ?? { port: DEFAULT_PORT };
diff --git a/api/test/server.test.js b/api/test/server.test.js
index 726ee4ff12db9c40f1190e4cbc2efbc30fdf8f59..bf8b58af8f5d8cd3897441feee6d9a1a9138bec7
--- a/api/test/server.test.js
+++ b/api/test/server.test.js
@@ -7,6 +7,8 @@
   adminJwtSecret: 'test-admin-secret',
   adminJwtIssuer: 'mega-directory',
   adminJwtAudience: 'admin',
+  adminLoginEmail: 'admin@example.com',
+  adminLoginPasscode: 'letmein',
   crawlerBearerToken: 'crawler-token'
 });
 
@@ -125,6 +127,73 @@
   assert.strictEqual(req.admin.role, 'admin');
 });
 
+test('admin auth route rejects missing credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', body: {} }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 400);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+  assert.ok(Array.isArray(res.body.details));
+  assert.ok(res.body.details.some((msg) => msg.includes('email')));
+  assert.ok(res.body.details.some((msg) => msg.includes('passcode')));
+});
+
+test('admin auth route rejects invalid credentials', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/admin/auth');
+  const res = runRoute(
+    route,
+    createRequest({
+      method: 'POST',
+      body: { email: 'admin@example.com', passcode: 'wrong-pass' }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Invalid admin credentials');
+});
+
+test('admin auth issues JWTs that unlock protected routes', () => {
+  const app = createServer(baseConfig);
+  const authRoute = findRoute(app, 'post', '/v1/admin/auth');
+  const loginRes = runRoute(
+    authRoute,
+    createRequest({
+      method: 'POST',
+      body: { email: baseConfig.adminLoginEmail, passcode: baseConfig.adminLoginPasscode }
+    }),
+    createResponse()
+  );
+
+  assert.strictEqual(loginRes.statusCode, 200);
+  assert.strictEqual(typeof loginRes.body.token, 'string');
+  assert.strictEqual(loginRes.body.tokenType, 'Bearer');
+  assert.strictEqual(loginRes.body.expiresIn, 900);
+
+  const decoded = jwt.verify(loginRes.body.token, baseConfig.adminJwtSecret, {
+    issuer: baseConfig.adminJwtIssuer,
+    audience: baseConfig.adminJwtAudience
+  });
+  assert.strictEqual(decoded.role, 'admin');
+  assert.strictEqual(decoded.sub, baseConfig.adminLoginEmail.toLowerCase());
+
+  const pingRoute = findRoute(app, 'get', '/v1/admin/ping');
+  const pingRes = runRoute(
+    pingRoute,
+    createRequest({ headers: { Authorization: `Bearer ${loginRes.body.token}` } }),
+    createResponse()
+  );
+
+  assert.strictEqual(pingRes.statusCode, 200);
+  assert.deepStrictEqual(pingRes.body, { status: 'admin-ok' });
+});
+
 test('crawler ping rejects invalid bearer token', () => {
   const app = createServer(baseConfig);
   const route = findRoute(app, 'post', '/v1/crawler/ping');

tokens used
81,925
Added the missing credential-backed admin auth flow so protected routes can be exercised end-to-end.

**Admin Auth**
- Required login email/passcode plus token TTL handling inside `resolveConfig`, so missing env values fail fast before the server starts (`api/index.js:18`, `api/index.js:34`, `api/index.js:40`).
- Registered `POST /v1/admin/auth` and implemented `createAdminAuthHandler` to validate credentials, issue 15â€‘minute JWTs, and return metadata for callers (`api/index.js:74`, `api/index.js:143`).

**Tests**
- `npm test` (from `api/`)

**Next Steps**
- Set `ADMIN_LOGIN_EMAIL`, `ADMIN_LOGIN_PASSCODE`, and optionally `ADMIN_TOKEN_TTL_SECONDS` in the API environment so the new auth route can operate with real credentials.
