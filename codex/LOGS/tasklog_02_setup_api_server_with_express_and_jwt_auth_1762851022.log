OpenAI Codex v0.57.0 (research preview)
--------
workdir: /var/home/rick/Development/mega-directory
model: gpt-5-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a721b-e750-75a1-b3a7-e1fd78e78d8e
--------
user
Implement the functionality described in codex/TASKS/02_setup_api_server_with_express_and_jwt_auth.yaml, then verify with any available tests.

thinking
**Preparing to inspect repository structure**
exec
bash -lc ls in /var/home/rick/Development/mega-directory succeeded in 47ms:
admin
agents
AGENTS.md
api
astro
codex
codex.toml
codex.yaml
db
docker-compose.yml
docs
README.md

thinking
**Opening setup task file**
exec
bash -lc "sed -n '1,160p' codex/TASKS/02_setup_api_server_with_express_and_jwt_auth.yaml" in /var/home/rick/Development/mega-directory succeeded in 48ms:
id: 2
title: Setup API Server with Express and JWT Auth
description: Create a Node.js Express API server with JWT-based authentication for
  admin access and a bearer token for crawler communication.
dependencies: []

thinking
**Checking for more instructions**
exec
bash -lc "sed -n '1,200p' README.md" in /var/home/rick/Development/mega-directory succeeded in 52ms:
# Mega Directory

Mega Directory is a server-rendered directory listing platform built with Astro, Express, and Prisma. It supports dynamic subdomains, AI-generated content enrichment, and moderation workflows.

## Features

- ðŸ›°ï¸ Subdomain-based regional directories (e.g. electricians.nyc.example.com)
- âš¡ Express API with JWT-based auth
- ðŸ§  AI agents for crawling, enrichment, and moderation (via OpenRouter)
- ðŸ§© Admin dashboard for approving or rejecting listings
- ðŸ’… Tailwind CSS and minimal JavaScript for accessibility and performance
- ðŸ³ Dockerized and deployable behind Cloudflare with SSR

## Tech Stack

- Astro (SSR)
- Express.js
- Prisma + PostgreSQL
- Tailwind CSS
- OpenRouter (AI Agents)

thinking
**Exploring API folder contents**
exec
bash -lc 'ls api' in /var/home/rick/Development/mega-directory succeeded in 49ms:
Dockerfile
index.js
package.json

thinking
**Viewing index.js contents**
exec
bash -lc "sed -n '1,200p' api/index.js" in /var/home/rick/Development/mega-directory succeeded in 52ms:
const express = require('express');

const app = express();
const port = process.env.PORT || 3001;

app.use(express.json());

app.get('/health', (_req, res) => {
  res.json({ status: 'ok' });
});

app.listen(port, () => {
  console.log(`API server running at http://localhost:${port}`);
});

thinking
**Reviewing package.json for implementation**
exec
bash -lc 'cat api/package.json' in /var/home/rick/Development/mega-directory succeeded in 94ms:
{
  "name": "mega-directory-api",
  "private": true,
  "version": "0.1.0",
  "main": "index.js",
  "scripts": {
    "dev": "node index.js",
    "start": "node index.js"
  },
  "dependencies": {
    "express": "^4.19.2"
  }
}

thinking
**Searching for authentication details**
exec
bash -lc 'rg -n "JWT" -n' in /var/home/rick/Development/mega-directory succeeded in 252ms:
AGENTS.md:83:* JWT and API token auth
docs/AGENTS.md:83:* JWT and API token auth
README.md:8:- âš¡ Express API with JWT-based auth
README.md:44:Provide an `.env` file for the API service (e.g., JWT secrets, database URLs) before running Compose. Postgres data is stored in the `pgdata` volume declared in the compose file.
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:37:title: Setup API Server with Express and JWT Auth
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:38:description: Create a Node.js Express API server with JWT-based authentication for
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:53:- âš¡ Express API with JWT-based auth
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:115:bash -lc 'rg -n "JWT" -n' in /var/home/rick/Development/mega-directory
codex/TASKS/05_admin_auth_route_and_middleware.yaml:3:description: Protect admin endpoints using JWT. Setup route to authenticate and issue
codex/TASKS/02_setup_api_server_with_express_and_jwt_auth.yaml:2:title: Setup API Server with Express and JWT Auth
codex/TASKS/02_setup_api_server_with_express_and_jwt_auth.yaml:3:description: Create a Node.js Express API server with JWT-based authentication for
codex/TASKS/CODEX_TODO.md:17:- [ ] 02_initialize_api_server.yaml â€” Set up the Express/PostgreSQL API server with base routing and JWT auth.

thinking
**Checking detailed log files**
exec
bash -lc "sed -n '1,200p' codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log" in /var/home/rick/Development/mega-directory succeeded in 50ms:
OpenAI Codex v0.57.0 (research preview)
--------
workdir: /var/home/rick/Development/mega-directory
model: gpt-5-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a721b-e750-75a1-b3a7-e1fd78e78d8e
--------
user
Implement the functionality described in codex/TASKS/02_setup_api_server_with_express_and_jwt_auth.yaml, then verify with any available tests.

thinking
**Preparing to inspect repository structure**
exec
bash -lc ls in /var/home/rick/Development/mega-directory succeeded in 47ms:
admin
agents

thinking
**Waiting for more information**
exec
bash -lc "sed -n '200,400p' codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log" in /var/home/rick/Development/mega-directory succeeded in 50ms:


thinking
**Identifying core requirements for API server**
exec
bash -lc "sed -n '1,200p' codex/TASKS/CODEX_TODO.md" in /var/home/rick/Development/mega-directory succeeded in 44ms:
# CODEX TODO

This document lists the Codex tasks in their recommended execution order.
Each task corresponds to a YAML file under `/codex/TASKS/`.

---

## 00 - Repository Setup

- [ ] 00_prepare_repository.yaml â€” Prepare the repository structure, move directories into place, update README and docker-compose config.

---

## 01â€“05 - Core Scaffolding

- [ ] 01_initialize_astro_frontend.yaml â€” Scaffold the Astro SSR frontend site.
- [ ] 02_initialize_api_server.yaml â€” Set up the Express/PostgreSQL API server with base routing and JWT auth.
- [ ] 03_initialize_database_schema.yaml â€” Define and migrate core tables: listings, categories, locations, directory.
- [ ] 04_initialize_admin_app.yaml â€” Scaffold a separate admin web interface with basic routing and layout.
- [ ] 05_initialize_python_crawler.yaml â€” Bootstrap the external Python-based crawler project with config loading and CLI entrypoint.

thinking
**Planning API server and tests setup**
exec
bash -lc 'rg -n "crawler" -n' in /var/home/rick/Development/mega-directory succeeded in 55ms:
AGENTS.md:77:Serve listings to the frontend, receive data from crawler, and power the admin interface.
AGENTS.md:88:* Accept and validate new data from the crawler
codex.yaml:24:    path: codex/TASKS/10_scaffold_python_crawler_agent.yaml
codex.yaml:28:    path: codex/TASKS/12_post_listings_from_crawler_to_api_server.yaml
codex.yaml:30:    path: codex/TASKS/13_create_json_crawler_configuration_schema.yaml
docs/AGENTS.md:77:Serve listings to the frontend, receive data from crawler, and power the admin interface.
docs/AGENTS.md:88:* Accept and validate new data from the crawler
README.md:48:The admin interface and crawler agent run outside Docker so that they can be operated from developer machines or private servers.
README.md:55:- Python crawler agent (configure `agents/crawler/config/targets.json` first):  
README.md:57:  cd agents/crawler
README.md:69:/agents/crawler    - Python crawler agent source + configs
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:39:  admin access and a bearer token for crawler communication.
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:183:- [ ] 05_initialize_python_crawler.yaml â€” Bootstrap the external Python-based crawler project with config loading and CLI entrypoint.
codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log:188:bash -lc 'rg -n "crawler" -n' in /var/home/rick/Development/mega-directory
astro/src/pages/index.astro:139:        Combine crawler data with the admin app or pipe everything through the API server.
agents/crawler/crawler.py:1:def run_crawler(config):
agents/crawler/crawler.py:3:        print(f"Running crawler for category: {target['category']} in locations: {target.get('locations', [])}")
astro/src/components/HeroSection.astro:18:  description = 'Mega Directory pairs trusted crawlers with editorial review so every listing feels intentional. Filter by accessibility scores, SEO readiness, or the data you already track.',
codex/LOGS/codex_run_2025-11-11_03-24-35.log:7:Tasks: 01_initialize_astro_frontend 02_initialize_api_server 03_initialize_database_schema 04_initialize_admin_app 05_initialize_python_crawler 23_docker_compose_local_dev 06_api_endpoints_listings 07_api_endpoints_categories 08_api_token_auth
agents/crawler/main.py:2:from crawler import run_crawler

thinking
**Outlining implementation plan with tests**

Iâ€™m setting up a plan with four steps: finalizing requirements and test plans, adding tests that will initially fail, implementing the server and configuration, and running the tests. This approach will help me stay organized and ensure the features are thoroughly verified.
Plan update
  â†’ Design API server requirements and identify needed routes/auth flows
  â€¢ Write failing tests covering health, admin JWT auth middleware, and crawler bearer token enforcement
  â€¢ Implement Express server, configuration, and middleware to satisfy tests
  â€¢ Run test suite and adjust as needed

thinking
**Planning API server design and tests**

Iâ€™m outlining the features and routes for an Express API server with JWT-based admin authentication and bearer token checks for crawler access. Iâ€™m considering environment variables, middleware, placeholder routes, and a test-driven approach using vitest and supertest before implementing the actual server logic.
Plan update
  âœ“ Design API server requirements and identify needed routes/auth flows
  â†’ Write failing tests covering health, admin JWT auth, and crawler bearer token enforcement
  â€¢ Implement Express server, configuration, and middleware to satisfy tests
  â€¢ Run test suite and adjust as needed

thinking
**Preparing test setup and architecture**

I'm outlining a detailed test-driven approach by writing tests first that reference a new `createServer` function and new endpoints for admin and crawler routes. I also consider restructuring existing files and carefully plan dev dependencies, test scripts, and how to handle JWTs and tokens despite network restrictions limiting package installation. This way, I can establish a solid testing foundation even before the implementation exists.
exec
bash -lc 'ls api/node_modules' in /var/home/rick/Development/mega-directory exited 2 in 38ms:
ls: cannot access 'api/node_modules': No such file or directory

thinking
**Checking dependency installation constraints**
exec
bash -lc 'ls api | grep lock' in /var/home/rick/Development/mega-directory exited 1 in 41ms:


thinking
**Assessing express dependency availability**
exec
bash -lc 'find .. -maxdepth 2 -name node_modules -type d' in /var/home/rick/Development/mega-directory succeeded in 4.17s:
../react-profile-image-uploader/node_modules
../remark-markdown-extensions/node_modules
../astro-content-audio/node_modules
../playlist-manager/node_modules
../mega-directory.bku/node_modules

thinking
**Checking dependency availability**
exec
bash -lc 'ls node_modules' in /var/home/rick/Development/mega-directory exited 2 in 67ms:
ls: cannot access 'node_modules': No such file or directory

thinking
**Evaluating npm install feasibility and node_modules locations**
exec
bash -lc 'ls /var/home/rick/node_modules' in /var/home/rick/Development/mega-directory succeeded in 71ms:
@astrojs
@bluwy
@isaacs

thinking
**Checking node_modules contents**
exec
bash -lc 'ls /var/home/rick/node_modules | head' in /var/home/rick/Development/mega-directory succeeded in 71ms:
@astrojs
@bluwy
@isaacs

thinking
**Evaluating express module availability**

I'm exploring options for handling the missing express dependency: searching local and global node_modules, considering a minimal custom server, or reusing express from a sibling project's node_modules via symlinks or setting NODE_PATH. I want to confirm what's present in the sibling node_modules next.
exec
bash -lc 'ls ../mega-directory.bku/node_modules | head' in /var/home/rick/Development/mega-directory succeeded in 264ms:
accepts
ansi-regex
ansi-styles
atomic-sleep
@babel
basic-auth
bcrypt
body-parser
buffer-equal-constant-time
bytes

thinking
**Considering dependency management approaches**

Iâ€™m weighing options to get necessary node modules like express for the project: setting NODE_PATH to include a sibling node_modules folder, copying selected modules over, or running npm install here to use local caches if available. I want to try running npm install first to see if dependencies can be fetched or accessed offline before committing to complex copying strategies.
exec
bash -lc 'npm install' in /var/home/rick/Development/mega-directory/api exited 1 in 1m 10s:
npm error code EAI_AGAIN
npm error syscall getaddrinfo
npm error errno EAI_AGAIN
npm error request to https://registry.npmjs.org/express failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org
npm error Log files were not written due to an error writing to the directory: /home/rick/.npm/_logs
npm error You can rerun the command with `--loglevel=verbose` to see the logs in your terminal

thinking
**Handling offline constraints and dependencies**
exec
bash -lc "find .. -path '*node_modules/express' -type d" in /var/home/rick/Development/mega-directory exited 124 in 2m 00s:


thinking
**Restricting search scope to specific directory**
exec
bash -lc "find ../mega-directory.bku -path '*node_modules/express' -type d" in /var/home/rick/Development/mega-directory succeeded in 7.28s:
../mega-directory.bku/node_modules/express

thinking
**Checking for needed packages**
exec
bash -lc 'ls ../mega-directory.bku/node_modules | grep jsonwebtoken' in /var/home/rick/Development/mega-directory succeeded in 46ms:
jsonwebtoken

thinking
**Checking for supertest presence**
exec
bash -lc 'ls ../mega-directory.bku/node_modules | grep supertest' in /var/home/rick/Development/mega-directory exited 1 in 42ms:


thinking
**Considering vitest for testing**
exec
bash -lc 'ls ../mega-directory.bku/node_modules | grep vitest' in /var/home/rick/Development/mega-directory exited 1 in 44ms:


thinking
**Exploring testing strategies without dependencies**

I'm weighing options for testing without relying on vitest or installing new packages, considering Node 18's built-in `node:test` and its global `fetch` for HTTP calls. Iâ€™m also trying to locate `supertest` in nearby directories to possibly reuse it, while keeping network and scanning overhead minimal.
exec
bash -lc "find .. -maxdepth 3 -path '*node_modules/supertest' -type d" in /var/home/rick/Development/mega-directory succeeded in 2.40s:


thinking
**Adopting built-in Node testing**
exec
bash -lc 'node -v' in /var/home/rick/Development/mega-directory succeeded in 62ms:
v22.20.0

thinking
**Weighing dependency handling and test setup**

Iâ€™m sorting through using Express and jsonwebtoken without local installs by temporarily leveraging another projectâ€™s node_modules via NODE_PATH when running tests, while making sure the userâ€™s setup stays clean. Iâ€™m also planning the server structure, middleware, routes, and test files using built-in Node 22 features and writing tests prior to full implementation. This approach keeps dependencies out of the repo but allows me to verify functionality thoroughly.
file update
A /var/home/rick/Development/mega-directory/api/test/server.test.js
const test = require('node:test');
const assert = require('node:assert');
const jwt = require('jsonwebtoken');
const { once } = require('node:events');
const { createServer } = require('..');

const baseConfig = Object.freeze({
  adminJwtSecret: 'test-admin-secret',
  adminJwtIssuer: 'mega-directory',
  adminJwtAudience: 'admin',
  crawlerBearerToken: 'crawler-token'
});

async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
  const server = app.listen(0);
  await once(server, 'listening');
  const { port } = server.address();
  const url = `http://127.0.0.1:${port}${path}`;
  const options = {
    method,
    headers: {
      ...(body ? { 'Content-Type': 'application/json' } : {}),
      ...headers
    },
    body: body ? JSON.stringify(body) : undefined
  };

  const response = await fetch(url, options);
  const text = await response.text();
  let payload;
  try {
    payload = JSON.parse(text);
  } catch (_err) {
    payload = text;
  }
  server.close();
  return { status: response.status, body: payload };
}

test('health endpoint reports ok', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, { path: '/health' });
  assert.strictEqual(result.status, 200);
  assert.deepStrictEqual(result.body, { status: 'ok' });
});

test('admin ping rejects missing token', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, { path: '/v1/admin/ping' });
  assert.strictEqual(result.status, 401);
  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
});

test('admin ping accepts valid JWT', async () => {
  const app = createServer(baseConfig);
  const token = jwt.sign(
    { role: 'admin' },
    baseConfig.adminJwtSecret,
    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
  );

  const result = await makeRequest(app, {
    path: '/v1/admin/ping',
    headers: { Authorization: `Bearer ${token}` }
  });

  assert.strictEqual(result.status, 200);
  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
});

test('crawler ping rejects invalid bearer token', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, {
    method: 'POST',
    path: '/v1/crawler/ping',
    headers: { Authorization: 'Bearer wrong-token' }
  });

  assert.strictEqual(result.status, 401);
  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
});

test('crawler ping accepts matching bearer token', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, {
    method: 'POST',
    path: '/v1/crawler/ping',
    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
  });

  assert.strictEqual(result.status, 200);
  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
});

test('createServer throws when secrets are missing', () => {
  assert.throws(() => {
    createServer({ crawlerBearerToken: 'only-crawler' });
  }, /ADMIN_JWT_SECRET/);

  assert.throws(() => {
    createServer({ adminJwtSecret: 'only-admin' });
  }, /CRAWLER_BEARER_TOKEN/);
});
apply_patch(auto_approved=true) exited 0 in 5ms:
Success. Updated the following files:
A api/test/server.test.js
file update:
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});

file update:
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Preparing test environment**
file update
M /var/home/rick/Development/mega-directory/api/package.json
@@ -7,6 +7,8 @@
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
apply_patch(auto_approved=true) exited 0 in 6ms:
Success. Updated the following files:
M api/package.json
file update:
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});

file update:
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Updating plan status**
Plan update
  âœ“ Design API server requirements and identify needed routes/auth flows
  âœ“ Write failing tests covering health, admin JWT auth, and crawler bearer token enforcement
  â†’ Implement Express server, configuration, and middleware to satisfy tests
  â€¢ Run test suite and adjust as needed
file update:
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Preparing environment for test run**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test' in /var/home/rick/Development/mega-directory exited 1 in 1.69s:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# Subtest: test/server.test.js
not ok 1 - test/server.test.js
  ---
  duration_ms: 1021.230963
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:1:1'
  failureType: 'testCodeFailure'
  exitCode: 1
  signal: ~
  error: 'test failed'
  code: 'ERR_TEST_FAILURE'
  ...
1..1
# tests 1
# suites 0
file update:
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Planning detailed test runs**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node --test test/server.test.js' in /var/home/rick/Development/mega-directory exited 1 in 455ms:
TAP version 13
# Subtest: test/server.test.js
not ok 1 - test/server.test.js
  ---
  duration_ms: 275.695809
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:1:1'
  failureType: 'testCodeFailure'
  exitCode: 1
  signal: ~
  error: 'test failed'
  code: 'ERR_TEST_FAILURE'
  ...
1..1
# tests 1
# suites 0
# pass 0
# fail 1
# cancelled 0
# skipped 0
file update:
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Checking test debugging options**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node --test --test-reporter spec test/server.test.js' in /var/home/rick/Development/mega-directory exited 1 in 572ms:
âœ– test/server.test.js (297.097206ms)
â„¹ tests 1
â„¹ suites 0
â„¹ pass 0
â„¹ fail 1
â„¹ cancelled 0
â„¹ skipped 0
â„¹ todo 0
â„¹ duration_ms 312.308803

âœ– failing tests:

test at test/server.test.js:1:1
âœ– test/server.test.js (297.097206ms)
  'test failed'
file update:
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Investigating test execution errors**
exec
bash -lc "cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node -p \"typeof require('jsonwebtoken')\"" in /var/home/rick/Development/mega-directory succeeded in 174ms:
object
file update:
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Designing server implementation plan**
file update
M /var/home/rick/Development/mega-directory/api/index.js
@@ -1,14 +1,113 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
 
-const app = express();
-const port = process.env.PORT || 3001;
+const DEFAULT_PORT = 3001;
 
-app.use(express.json());
+function resolveConfig(overrides = {}) {
+  const baseConfig = {
+    port: overrides.port ?? parseInt(process.env.PORT, 10) || DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
apply_patch(auto_approved=true) exited 0 in 8ms:
Success. Updated the following files:
M api/index.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..2045803a6f6a15caf78d6b1b47ae8bfed80b57ba
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,113 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
 
-const app = express();
-const port = process.env.PORT || 3001;
+const DEFAULT_PORT = 3001;
 
-app.use(express.json());
+function resolveConfig(overrides = {}) {
+  const baseConfig = {
+    port: overrides.port ?? parseInt(process.env.PORT, 10) || DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..2045803a6f6a15caf78d6b1b47ae8bfed80b57ba
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,113 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
 
-const app = express();
-const port = process.env.PORT || 3001;
+const DEFAULT_PORT = 3001;
 
-app.use(express.json());
+function resolveConfig(overrides = {}) {
+  const baseConfig = {
+    port: overrides.port ?? parseInt(process.env.PORT, 10) || DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Verifying server setup and running tests**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test' in /var/home/rick/Development/mega-directory exited 1 in 544ms:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# /var/home/rick/Development/mega-directory/api/index.js:8
#     port: overrides.port ?? parseInt(process.env.PORT, 10) || DEFAULT_PORT,
#                                                            ^^
# SyntaxError: Unexpected token '||'
#     at wrapSafe (node:internal/modules/cjs/loader:1638:18)
#     at Module._compile (node:internal/modules/cjs/loader:1680:20)
#     at Module._extensions..js (node:internal/modules/cjs/loader:1839:10)
#     at Module.load (node:internal/modules/cjs/loader:1441:32)
#     at Module._load (node:internal/modules/cjs/loader:1263:12)
#     at TracingChannel.traceSync (node:diagnostics_channel:322:14)
#     at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
#     at Module.require (node:internal/modules/cjs/loader:1463:12)
#     at require (node:internal/modules/helpers:147:16)
#     at Object.<anonymous> (/var/home/rick/Development/mega-directory/api/test/server.test.js:5:26)
# Node.js v22.20.0
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..2045803a6f6a15caf78d6b1b47ae8bfed80b57ba
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,113 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
 
-const app = express();
-const port = process.env.PORT || 3001;
+const DEFAULT_PORT = 3001;
 
-app.use(express.json());
+function resolveConfig(overrides = {}) {
+  const baseConfig = {
+    port: overrides.port ?? parseInt(process.env.PORT, 10) || DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Adjusting port configuration expression**
file update
M /var/home/rick/Development/mega-directory/api/index.js
@@ -6,4 +6,5 @@
 function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
   const baseConfig = {
-    port: overrides.port ?? parseInt(process.env.PORT, 10) || DEFAULT_PORT,
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
     adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
apply_patch(auto_approved=true) exited 0 in 8ms:
Success. Updated the following files:
M api/index.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Rerunning tests to verify changes**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test' in /var/home/rick/Development/mega-directory exited 1 in 657ms:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# Subtest: test/server.test.js
not ok 1 - test/server.test.js
  ---
  duration_ms: 271.342012
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:1:1'
  failureType: 'testCodeFailure'
  exitCode: 1
  signal: ~
  error: 'test failed'
  code: 'ERR_TEST_FAILURE'
  ...
1..1
# tests 1
# suites 0
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Running tests with spec reporter**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node --test --test-reporter spec' in /var/home/rick/Development/mega-directory exited 1 in 480ms:
âœ– test/server.test.js (294.196317ms)
â„¹ tests 1
â„¹ suites 0
â„¹ pass 0
â„¹ fail 1
â„¹ cancelled 0
â„¹ skipped 0
â„¹ todo 0
â„¹ duration_ms 316.974014

âœ– failing tests:

test at test/server.test.js:1:1
âœ– test/server.test.js (294.196317ms)
  'test failed'
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Investigating test execution issues**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node test/server.test.js' in /var/home/rick/Development/mega-directory exited 1 in 291ms:
TAP version 13
# Subtest: health endpoint reports ok
not ok 1 - health endpoint reports ok
  ---
  duration_ms: 9.500811
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:40:1'
  failureType: 'testCodeFailure'
  error: 'listen EPERM: operation not permitted 0.0.0.0'
  code: 'EPERM'
  stack: |-
    Server.setupListenHandle [as _listen2] (node:net:1918:21)
    listenInCluster (node:net:1997:12)
    Server.listen (node:net:2102:7)
    Function.listen (/var/home/rick/Development/mega-directory.bku/node_modules/express/lib/application.js:605:24)
    makeRequest (/var/home/rick/Development/mega-directory/api/test/server.test.js:15:22)
    TestContext.<anonymous> (/var/home/rick/Development/mega-directory/api/test/server.test.js:42:24)
    Test.runInAsyncScope (node:async_hooks:214:14)
    Test.run (node:internal/test_runner/test:1047:25)
    Test.start (node:internal/test_runner/test:944:17)
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3d4d070bcc3b834fd04623375c5709499a65baac
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0);
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Adjusting server listen address in tests**

I'm noticing tests fail because `app.listen(0)` defaults to binding `0.0.0.0`, which the workspace forbids. To fix this, I'll update `makeRequest` to listen explicitly on `127.0.0.1` instead, ensuring compliance with network restrictions. I'll also consider awaiting server close events properly after the tests finish.
file update
M /var/home/rick/Development/mega-directory/api/test/server.test.js
@@ -14,3 +14,3 @@
 async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
-  const server = app.listen(0);
+  const server = app.listen(0, '127.0.0.1');
   await once(server, 'listening');
apply_patch(auto_approved=true) exited 0 in 8ms:
Success. Updated the following files:
M api/test/server.test.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..b9d976af1ee983224472f10dac3914d79976e54d
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0, '127.0.0.1');
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..b9d976af1ee983224472f10dac3914d79976e54d
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0, '127.0.0.1');
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Considering awaiting server close**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test' in /var/home/rick/Development/mega-directory exited 1 in 663ms:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# Subtest: test/server.test.js
not ok 1 - test/server.test.js
  ---
  duration_ms: 273.201329
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:1:1'
  failureType: 'testCodeFailure'
  exitCode: 1
  signal: ~
  error: 'test failed'
  code: 'ERR_TEST_FAILURE'
  ...
1..1
# tests 1
# suites 0
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..b9d976af1ee983224472f10dac3914d79976e54d
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0, '127.0.0.1');
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Rerunning tests without flags**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node test/server.test.js' in /var/home/rick/Development/mega-directory exited 1 in 319ms:
TAP version 13
# Subtest: health endpoint reports ok
not ok 1 - health endpoint reports ok
  ---
  duration_ms: 16.456266
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:40:1'
  failureType: 'testCodeFailure'
  error: 'listen EPERM: operation not permitted 127.0.0.1'
  code: 'EPERM'
  stack: |-
    Server.setupListenHandle [as _listen2] (node:net:1918:21)
    listenInCluster (node:net:1997:12)
    node:net:2206:7
    process.processTicksAndRejections (node:internal/process/task_queues:90:21)
  ...
# Subtest: admin ping rejects missing token
not ok 2 - admin ping rejects missing token
  ---
  duration_ms: 3.012182
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..b9d976af1ee983224472f10dac3914d79976e54d
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0, '127.0.0.1');
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});


thinking
**Exploring alternatives to test Express without network listening**

Iâ€™m thinking through ways to test the Express app without opening actual listening sockets, since sandbox restrictions block binding to ports. Iâ€™m considering using `app.handle` with mock request and response objects, maybe made with Node streams, but building those to satisfy Express will be tricky. Using `supertest` would be ideal since it can call the app directly without network, but installing it isn't possible here. As a last resort, Iâ€™m planning to search deeply for any existing local `supertest` installations in the repo to see if I can reuse it.
exec
bash -lc "find /var/home/rick -path '*node_modules/supertest' -type d 2>/dev/null | head" in /var/home/rick/Development/mega-directory exited 124 in 2m 00s:

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..c52535a46900b60571ae7880160438ddd62a7236
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,114 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const header = req.header('Authorization');
+  if (!header) {
+    return null;
+  }
+
+  const [scheme, token] = header.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
 
-const app = express();
-const port = process.env.PORT || 3001;
+  return token;
+}
 
-app.use(express.json());
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..b9d976af1ee983224472f10dac3914d79976e54d
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0, '127.0.0.1');
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});




thinking
**Devising a custom HTTP invoke helper**

Iâ€™m working out how to simulate HTTP requests to an Express app without a real network. Iâ€™m thinking of using Nodeâ€™s `http.IncomingMessage` and `http.ServerResponse` with mock sockets built from streams to fake requests and capture full HTTP responses, then parsing those responses to extract status and body. This involves crafting a `MockSocket` class extending `Duplex` to satisfy `ServerResponse` needs, overriding necessary methods, and using event listeners to await response completion. Itâ€™s a tricky balance to replicate enough of Nodeâ€™s HTTP internals so Express middleware works, without starting an actual server or relying on external libraries like `supertest`. Iâ€™ll implement an `invoke(app, options)` helper around this idea to enable test requests purely in-process.
thinking
**Finalizing mock socket and request helper**

Iâ€™m refining the `MockSocket` class to fully support `ServerResponse`â€™s expectations, adding methods like `setTimeout`, `cork`, and proper event handling while collecting written chunks. I plan to implement a `makeRequest` function that creates `IncomingMessage` and `ServerResponse` instances using these mock sockets, drives the Express app with them, and captures/parses the raw HTTP response data. To verify this approach, I intend to test with a simple Express app and iterate until the helper produces usable results. Given the complexity, Iâ€™m also considering alternative test strategies like directly invoking middleware or route handlers with simplified mocks to bypass full HTTP simulation while still verifying core behavior.
thinking
**Implementing manual route invocation for tests**

Iâ€™m setting up a way to manually run Express route stacks by invoking their middleware and handlers with simple mock request and response objects. This includes writing a `runRoute` function to sequentially execute each middleware/handler, handling sync and async functions via a custom `next` mechanism. Iâ€™ll adjust the server code to access headers directly (e.g., via `req.headers.authorization`) instead of using Expressâ€™s `req.header` method, so the mocks can stay simple. This approach lets me test routes and middleware without needing full HTTP simulation or an actual listening server.
file update
M /var/home/rick/Development/mega-directory/api/index.js
@@ -54,4 +54,9 @@
 function extractBearerToken(req) {
-  const header = req.header('Authorization');
-  if (!header) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
     return null;
@@ -59,3 +64,3 @@
 
-  const [scheme, token] = header.split(' ');
+  const [scheme, token] = headerSource.split(' ');
   if (scheme?.toLowerCase() !== 'bearer' || !token) {
apply_patch(auto_approved=true) exited 0 in 12ms:
Success. Updated the following files:
M api/index.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..b9d976af1ee983224472f10dac3914d79976e54d
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0, '127.0.0.1');
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..b9d976af1ee983224472f10dac3914d79976e54d
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,103 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { once } = require('node:events');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
+  const server = app.listen(0, '127.0.0.1');
+  await once(server, 'listening');
+  const { port } = server.address();
+  const url = `http://127.0.0.1:${port}${path}`;
+  const options = {
+    method,
+    headers: {
+      ...(body ? { 'Content-Type': 'application/json' } : {}),
+      ...headers
+    },
+    body: body ? JSON.stringify(body) : undefined
+  };
+
+  const response = await fetch(url, options);
+  const text = await response.text();
+  let payload;
+  try {
+    payload = JSON.parse(text);
+  } catch (_err) {
+    payload = text;
+  }
+  server.close();
+  return { status: response.status, body: payload };
+}
+
+test('health endpoint reports ok', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/health' });
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, { path: '/v1/admin/ping' });
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', async () => {
+  const app = createServer(baseConfig);
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const result = await makeRequest(app, {
+    path: '/v1/admin/ping',
+    headers: { Authorization: `Bearer ${token}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
+});
+
+test('crawler ping rejects invalid bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: 'Bearer wrong-token' }
+  });
+
+  assert.strictEqual(result.status, 401);
+  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', async () => {
+  const app = createServer(baseConfig);
+  const result = await makeRequest(app, {
+    method: 'POST',
+    path: '/v1/crawler/ping',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+
+  assert.strictEqual(result.status, 200);
+  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
+});
+
+test('createServer throws when secrets are missing', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /ADMIN_JWT_SECRET/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /CRAWLER_BEARER_TOKEN/);
+});



thinking
**Designing comprehensive server tests**

I'm mapping out detailed test helpers and strategies to verify route existence, middleware behavior, and handlers by simulating Express request/response cycles with mock objects, ensuring proper token auth flows and response correctness without fully spinning up a server. This exercise involves carefully handling async middleware, calling next correctly, and extracting route stacks to directly invoke middleware and handlers for precise, isolated testing.
thinking
**Simplifying middleware testing with synchronous stack runner**

Iâ€™m refining the test helpers to run route middleware and handlers synchronously by manually invoking each layer with a next function that signals continuation, breaking when response ends or next isnâ€™t called. This lets me avoid async complexity and network calls, making tests streamlined and reliable while rewriting the test file completely with these new helpers.
file update
D /var/home/rick/Development/mega-directory/api/test/server.test.js
const test = require('node:test');
const assert = require('node:assert');
const jwt = require('jsonwebtoken');
const { once } = require('node:events');
const { createServer } = require('..');

const baseConfig = Object.freeze({
  adminJwtSecret: 'test-admin-secret',
  adminJwtIssuer: 'mega-directory',
  adminJwtAudience: 'admin',
  crawlerBearerToken: 'crawler-token'
});

async function makeRequest(app, { method = 'GET', path = '/', headers = {}, body } = {}) {
  const server = app.listen(0, '127.0.0.1');
  await once(server, 'listening');
  const { port } = server.address();
  const url = `http://127.0.0.1:${port}${path}`;
  const options = {
    method,
    headers: {
      ...(body ? { 'Content-Type': 'application/json' } : {}),
      ...headers
    },
    body: body ? JSON.stringify(body) : undefined
  };

  const response = await fetch(url, options);
  const text = await response.text();
  let payload;
  try {
    payload = JSON.parse(text);
  } catch (_err) {
    payload = text;
  }
  server.close();
  return { status: response.status, body: payload };
}

test('health endpoint reports ok', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, { path: '/health' });
  assert.strictEqual(result.status, 200);
  assert.deepStrictEqual(result.body, { status: 'ok' });
});

test('admin ping rejects missing token', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, { path: '/v1/admin/ping' });
  assert.strictEqual(result.status, 401);
  assert.strictEqual(result.body.error, 'Admin token missing or invalid');
});

test('admin ping accepts valid JWT', async () => {
  const app = createServer(baseConfig);
  const token = jwt.sign(
    { role: 'admin' },
    baseConfig.adminJwtSecret,
    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
  );

  const result = await makeRequest(app, {
    path: '/v1/admin/ping',
    headers: { Authorization: `Bearer ${token}` }
  });

  assert.strictEqual(result.status, 200);
  assert.deepStrictEqual(result.body, { status: 'admin-ok' });
});

test('crawler ping rejects invalid bearer token', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, {
    method: 'POST',
    path: '/v1/crawler/ping',
    headers: { Authorization: 'Bearer wrong-token' }
  });

  assert.strictEqual(result.status, 401);
  assert.strictEqual(result.body.error, 'Crawler token missing or invalid');
});

test('crawler ping accepts matching bearer token', async () => {
  const app = createServer(baseConfig);
  const result = await makeRequest(app, {
    method: 'POST',
    path: '/v1/crawler/ping',
    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
  });

  assert.strictEqual(result.status, 200);
  assert.deepStrictEqual(result.body, { status: 'crawler-ok' });
});

test('createServer throws when secrets are missing', () => {
  assert.throws(() => {
    createServer({ crawlerBearerToken: 'only-crawler' });
  }, /ADMIN_JWT_SECRET/);

  assert.throws(() => {
    createServer({ adminJwtSecret: 'only-admin' });
  }, /CRAWLER_BEARER_TOKEN/);
});
apply_patch(auto_approved=true) exited 0 in 7ms:
Success. Updated the following files:
D api/test/server.test.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }


thinking
**Adding new file with updated content**
file update
A /var/home/rick/Development/mega-directory/api/test/server.test.js
const test = require('node:test');
const assert = require('node:assert');
const jwt = require('jsonwebtoken');
const { createServer } = require('..');

const baseConfig = Object.freeze({
  adminJwtSecret: 'test-admin-secret',
  adminJwtIssuer: 'mega-directory',
  adminJwtAudience: 'admin',
  crawlerBearerToken: 'crawler-token'
});

function findRoute(app, method, path) {
  return app._router.stack.find(
    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
  );
}

function createRequest({ method = 'GET', headers = {} } = {}) {
  const normalized = Object.fromEntries(
    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
  );

  return {
    method,
    headers: normalized,
    get(name) {
      return this.headers[name.toLowerCase()];
    },
    header(name) {
      return this.get(name);
    }
  };
}

function createResponse() {
  return {
    statusCode: 200,
    headers: {},
    body: null,
    finished: false,
    status(code) {
      this.statusCode = code;
      return this;
    },
    json(payload) {
      this.body = payload;
      this.finished = true;
      return this;
    },
    set(field, value) {
      this.headers[field.toLowerCase()] = value;
      return this;
    }
  };
}

function runRoute(route, req, res) {
  if (!route) {
    throw new Error('Route not found');
  }

  for (const layer of route.route.stack) {
    let nextCalled = false;
    const next = () => {
      nextCalled = true;
    };
    layer.handle(req, res, next);
    if (!nextCalled || res.finished) {
      break;
    }
  }

  return res;
}

test('health endpoint reports ok', () => {
  const app = createServer(baseConfig);
  const route = findRoute(app, 'get', '/health');
  const res = runRoute(route, createRequest(), createResponse());

  assert.strictEqual(res.statusCode, 200);
  assert.deepStrictEqual(res.body, { status: 'ok' });
});

test('admin ping rejects missing token', () => {
  const app = createServer(baseConfig);
  const route = findRoute(app, 'get', '/v1/admin/ping');
  const res = runRoute(route, createRequest(), createResponse());

  assert.strictEqual(res.statusCode, 401);
  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
});

test('admin ping accepts valid JWT', () => {
  const app = createServer(baseConfig);
  const route = findRoute(app, 'get', '/v1/admin/ping');
  const token = jwt.sign(
    { role: 'admin' },
    baseConfig.adminJwtSecret,
    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
  );

  const req = createRequest({
    headers: { Authorization: `Bearer ${token}` }
  });
  const res = runRoute(route, req, createResponse());

  assert.strictEqual(res.statusCode, 200);
  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
  assert.strictEqual(req.admin.role, 'admin');
});

test('crawler ping rejects invalid bearer token', () => {
  const app = createServer(baseConfig);
  const route = findRoute(app, 'post', '/v1/crawler/ping');
  const res = runRoute(
    route,
    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
    createResponse()
  );

  assert.strictEqual(res.statusCode, 401);
  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
});

test('crawler ping accepts matching bearer token', () => {
  const app = createServer(baseConfig);
  const route = findRoute(app, 'post', '/v1/crawler/ping');
  const req = createRequest({
    method: 'POST',
    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
  });
  const res = runRoute(route, req, createResponse());

  assert.strictEqual(res.statusCode, 200);
  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
});

test('createServer enforces required configuration', () => {
  assert.throws(() => {
    createServer({ crawlerBearerToken: 'only-crawler' });
  }, /Missing required config value/);

  assert.throws(() => {
    createServer({ adminJwtSecret: 'only-admin' });
  }, /Missing required config value/);
});
apply_patch(auto_approved=true) exited 0 in 11ms:
Success. Updated the following files:
A api/test/server.test.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Verifying HTTP method handling and test setup**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test' in /var/home/rick/Development/mega-directory exited 1 in 703ms:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# Subtest: test/server.test.js
not ok 1 - test/server.test.js
  ---
  duration_ms: 252.993632
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:1:1'
  failureType: 'testCodeFailure'
  exitCode: 1
  signal: ~
  error: 'test failed'
  code: 'ERR_TEST_FAILURE'
  ...
1..1
# tests 1
# suites 0
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Running specific test file for details**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node test/server.test.js' in /var/home/rick/Development/mega-directory exited 1 in 299ms:
TAP version 13
# Subtest: health endpoint reports ok
not ok 1 - health endpoint reports ok
  ---
  duration_ms: 5.78908
  type: 'test'
  location: '/var/home/rick/Development/mega-directory/api/test/server.test.js:77:1'
  failureType: 'testCodeFailure'
  error: "Cannot read properties of undefined (reading 'stack')"
  code: 'ERR_TEST_FAILURE'
  name: 'TypeError'
  stack: |-
    findRoute (/var/home/rick/Development/mega-directory/api/test/server.test.js:14:22)
    TestContext.<anonymous> (/var/home/rick/Development/mega-directory/api/test/server.test.js:79:17)
    Test.runInAsyncScope (node:async_hooks:214:14)
    Test.run (node:internal/test_runner/test:1047:25)
    Test.start (node:internal/test_runner/test:944:17)
    startSubtestAfterBootstrap (node:internal/test_runner/harness:296:17)
  ...
# Subtest: admin ping rejects missing token
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Investigating route matching issues**
exec
bash -lc "cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node -e \"const { createServer } = require('..'); const app = createServer({ adminJwtSecret: 'a', crawlerBearerToken: 'b' }); console.log(app._router.stack.map(l => ({ route: l.route && { path: l.route.path, methods: l.route.methods } })));\"" in /var/home/rick/Development/mega-directory exited 1 in 146ms:
node:internal/modules/cjs/loader:1386
  throw err;
  ^

Error: Cannot find module '..'
Require stack:
- /var/home/rick/Development/mega-directory/api/[eval]
    at Module._resolveFilename (node:internal/modules/cjs/loader:1383:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1025:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1030:22)
    at Module._load (node:internal/modules/cjs/loader:1192:37)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
    at Module.require (node:internal/modules/cjs/loader:1463:12)
    at require (node:internal/modules/helpers:147:16)
    at [eval]:1:26
    at runScriptInThisContext (node:internal/vm:209:10) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [ '/var/home/rick/Development/mega-directory/api/[eval]' ]
}
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Clarifying module require paths**
exec
bash -lc "cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node -e \"const { createServer } = require('./'); const app = createServer({ adminJwtSecret: 'a', crawlerBearerToken: 'b' }); console.log(app._router.stack.map(l => ({ route: l.route && { path: l.route.path, methods: l.route.methods } })));\"" in /var/home/rick/Development/mega-directory exited 1 in 263ms:
[eval]:1
const { createServer } = require('./'); const app = createServer({ adminJwtSecret: 'a', crawlerBearerToken: 'b' }); console.log(app._router.stack.map(l => ({ route: l.route && { path: l.route.path, methods: l.route.methods } })));
                                                                                                                                            ^

TypeError: Cannot read properties of undefined (reading 'stack')
    at [eval]:1:141
    at runScriptInThisContext (node:internal/vm:209:10)
    at node:internal/process/execution:446:12
    at [eval]-wrapper:6:24
    at runScriptInContext (node:internal/process/execution:444:60)
    at evalFunction (node:internal/process/execution:279:30)
    at evalTypeScript (node:internal/process/execution:291:3)
    at node:internal/main/eval_string:74:3

Node.js v22.20.0
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Investigating undefined app._router**
exec
bash -lc "cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node -e \"const { createServer } = require('./'); const app = createServer({ adminJwtSecret: 'a', crawlerBearerToken: 'b' }); console.log(Object.keys(app)); console.log(app._router);\"" in /var/home/rick/Development/mega-directory succeeded in 251ms:
[
  '_events',         '_eventsCount',         '_maxListeners',
  'setMaxListeners', 'getMaxListeners',      'emit',
  'addListener',     'on',                   'prependListener',
  'once',            'prependOnceListener',  'removeListener',
  'off',             'removeAllListeners',   'listeners',
  'rawListeners',    'listenerCount',        'eventNames',
  'init',            'defaultConfiguration', 'handle',
  'use',             'route',                'engine',
  'param',           'set',                  'path',
  'enabled',         'disabled',             'enable',
  'disable',         'acl',                  'bind',
  'checkout',        'connect',              'copy',
  'delete',          'get',                  'head',
  'link',            'lock',                 'm-search',
  'merge',           'mkactivity',           'mkcalendar',
  'mkcol',           'move',                 'notify',
  'options',         'patch',                'post',
  'propfind',        'proppatch',            'purge',
  'put',             'query',                'rebind',
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Investigating Express router initialization**
exec
bash -lc "cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node -e \"const { createServer } = require('./'); const app = createServer({ adminJwtSecret: 'a', crawlerBearerToken: 'b' }); console.log(typeof app.router); console.log(app.router && Object.keys(app.router));\"" in /var/home/rick/Development/mega-directory succeeded in 249ms:
function
[ 'caseSensitive', 'mergeParams', 'params', 'strict', 'stack' ]
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..5468c3f9bc49a3f7801ccd934caf92a159ff9785
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,148 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  return app._router.stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Updating route stack access**
file update
M /var/home/rick/Development/mega-directory/api/test/server.test.js
@@ -13,3 +13,4 @@
 function findRoute(app, method, path) {
-  return app._router.stack.find(
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  return stack.find(
     (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
apply_patch(auto_approved=true) exited 0 in 11ms:
Success. Updated the following files:
M api/test/server.test.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3cb8fda871a2e5fd32097bb416f5363e1a63be01
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,149 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..3cb8fda871a2e5fd32097bb416f5363e1a63be01
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,149 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Ensuring HTTP method case consistency**
file update
M /var/home/rick/Development/mega-directory/api/test/server.test.js
@@ -14,4 +14,5 @@
   const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
   return stack.find(
-    (layer) => layer.route && layer.route.path === path && layer.route.methods[method]
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
   );
apply_patch(auto_approved=true) exited 0 in 16ms:
Success. Updated the following files:
M api/test/server.test.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Rerunning tests with partial configs**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules node test/server.test.js' in /var/home/rick/Development/mega-directory succeeded in 308ms:
TAP version 13
# Subtest: health endpoint reports ok
ok 1 - health endpoint reports ok
  ---
  duration_ms: 7.991598
  type: 'test'
  ...
# Subtest: admin ping rejects missing token
ok 2 - admin ping rejects missing token
  ---
  duration_ms: 0.907641
  type: 'test'
  ...
# Subtest: admin ping accepts valid JWT
ok 3 - admin ping accepts valid JWT
  ---
  duration_ms: 4.920788
  type: 'test'
  ...
# Subtest: crawler ping rejects invalid bearer token
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Running npm tests**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test' in /var/home/rick/Development/mega-directory succeeded in 668ms:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# Subtest: test/server.test.js
ok 1 - test/server.test.js
  ---
  duration_ms: 255.120479
  type: 'test'
  ...
1..1
# tests 1
# suites 0
# pass 1
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 274.934582
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Finalizing test environment notes**
Plan update
  âœ“ Design API server requirements and identify needed routes/auth flows
  âœ“ Write failing tests covering health, admin JWT auth, and crawler bearer token enforcement
  âœ“ Implement Express server, configuration, and middleware to satisfy tests
  âœ“ Run test suite and adjust as needed
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Checking git status**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/mega-directory succeeded in 78ms:
## main...origin/main
 M api/index.js
 M api/package.json
?? api/test/
?? codex/LOGS/codex_run_2025-11-11_03-50-22.log
?? codex/LOGS/tasklog_02_setup_api_server_with_express_and_jwt_auth_1762851022.log
?? codex/TASKS/work_list
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..e4dff49262adc0f46586ccf7b9d3db8fb256cd69
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,119 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
 
-const app = express();
-const port = process.env.PORT || 3001;
+  app.locals.config = config;
 
-app.use(express.json());
+  app.use(express.json());
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
+
+    return next();
+  };
+}
+
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
+
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
+
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Ensuring robust port parsing in api/index.js**
file update
M /var/home/rick/Development/mega-directory/api/index.js
@@ -6,3 +6,4 @@
 function resolveConfig(overrides = {}) {
-  const envPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
   const baseConfig = {
apply_patch(auto_approved=true) exited 0 in 9ms:
Success. Updated the following files:
M api/index.js
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..0a1f3116ad79342ae2f058272f3027ecd60f6eb7
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,120 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
 
-const app = express();
-const port = process.env.PORT || 3001;
+    return next();
+  };
+}
 
-app.use(express.json());
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});

file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..0a1f3116ad79342ae2f058272f3027ecd60f6eb7
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,120 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
 
-const app = express();
-const port = process.env.PORT || 3001;
+    return next();
+  };
+}
 
-app.use(express.json());
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Verifying port parsing logic**
exec
bash -lc 'cd api && NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test' in /var/home/rick/Development/mega-directory succeeded in 699ms:

> mega-directory-api@0.1.0 test
> node --test

TAP version 13
# Subtest: test/server.test.js
ok 1 - test/server.test.js
  ---
  duration_ms: 279.765122
  type: 'test'
  ...
1..1
# tests 1
# suites 0
# pass 1
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 300.330341
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..0a1f3116ad79342ae2f058272f3027ecd60f6eb7
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,120 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
 
-const app = express();
-const port = process.env.PORT || 3001;
+    return next();
+  };
+}
 
-app.use(express.json());
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Preparing final response details**
exec
bash -lc 'cd api && nl -ba index.js' in /var/home/rick/Development/mega-directory succeeded in 94ms:
     1	const express = require('express');
     2	const jwt = require('jsonwebtoken');
     3	
     4	const DEFAULT_PORT = 3001;
     5	
     6	function resolveConfig(overrides = {}) {
     7	  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
     8	  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
     9	  const baseConfig = {
    10	    port: overrides.port ?? envPort ?? DEFAULT_PORT,
    11	    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
    12	    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
    13	    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
    14	    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
    15	  };
    16	
    17	  const missing = [];
    18	  if (!baseConfig.adminJwtSecret) {
    19	    missing.push('ADMIN_JWT_SECRET');
    20	  }
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..0a1f3116ad79342ae2f058272f3027ecd60f6eb7
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,120 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
 
-const app = express();
-const port = process.env.PORT || 3001;
+    return next();
+  };
+}
 
-app.use(express.json());
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Preparing to add line numbers**
exec
bash -lc 'cd api && nl -ba test/server.test.js' in /var/home/rick/Development/mega-directory succeeded in 40ms:
     1	const test = require('node:test');
     2	const assert = require('node:assert');
     3	const jwt = require('jsonwebtoken');
     4	const { createServer } = require('..');
     5	
     6	const baseConfig = Object.freeze({
     7	  adminJwtSecret: 'test-admin-secret',
     8	  adminJwtIssuer: 'mega-directory',
     9	  adminJwtAudience: 'admin',
    10	  crawlerBearerToken: 'crawler-token'
    11	});
    12	
    13	function findRoute(app, method, path) {
    14	  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
    15	  const methodName = method.toLowerCase();
    16	  return stack.find(
    17	    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
    18	  );
    19	}
    20	
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..0a1f3116ad79342ae2f058272f3027ecd60f6eb7
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,120 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
 
-const app = express();
-const port = process.env.PORT || 3001;
+    return next();
+  };
+}
 
-app.use(express.json());
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Preparing to reference package.json**
exec
bash -lc 'cd api && nl -ba package.json' in /var/home/rick/Development/mega-directory succeeded in 40ms:
     1	{
     2	  "name": "mega-directory-api",
     3	  "private": true,
     4	  "version": "0.1.0",
     5	  "main": "index.js",
     6	  "scripts": {
     7	    "dev": "node index.js",
     8	    "start": "node index.js",
     9	    "test": "node --test"
    10	  },
    11	  "dependencies": {
    12	    "express": "^4.19.2",
    13	    "jsonwebtoken": "^9.0.2"
    14	  }
    15	}
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..0a1f3116ad79342ae2f058272f3027ecd60f6eb7
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,120 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
 
-const app = express();
-const port = process.env.PORT || 3001;
+    return next();
+  };
+}
 
-app.use(express.json());
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});


thinking
**Summarizing test and config details**

I'll outline the key test commands using `NODE_PATH` due to offline dependencies, highlight how tests simulate requests via the Express router stack because of environment constraints, and note newly introduced environment variables and config enforcement. I'll also mention relevant file line references for config setup, routes, and middleware, plus testing coverage, before suggesting next steps like installing dependencies and environment setup.
codex
**API Auth**
- `api/index.js:6` now centralizes config resolution (port defaults + required `ADMIN_JWT_SECRET`/`CRAWLER_BEARER_TOKEN`) so the server refuses to boot without the secrets.
- `api/index.js:32` wires the Express app with JSON parsing, `/health`, and protected `/v1/admin|crawler/ping` routes backed by the new JWT (`requireAdminAuth`) and bearer-token (`requireCrawlerToken`) middleware plus a header-agnostic bearer extractor (`api/index.js:55`).

**Verification**
- Added a lightweight test harness that inspects the Express router stack to simulate requests and assert the auth flows/route responses without opening sockets (`api/test/server.test.js:13`â€“150).
- Package script updated to run the Node test runner and JSON Web Token dependency declared for runtime signing/verification (`api/package.json:6`â€“14).

**Tests**
- `NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test` (set `NODE_PATH` because the sandbox canâ€™t hit npm; locally just `npm install && npm test`).

**Next**
- 1) Install dependencies inside `api` (`npm install`) so the new script works without the `NODE_PATH` hack. 2) Provide real `ADMIN_JWT_SECRET`/`CRAWLER_BEARER_TOKEN` env vars before running `npm run dev` or Docker Compose. 3) Start fleshing out real admin/crawler endpoints now that auth plumbing is in place.
file update:
diff --git a/api/index.js b/api/index.js
index c1166660e771eb069458fde9913db6aa14701119..0a1f3116ad79342ae2f058272f3027ecd60f6eb7
--- a/api/index.js
+++ b/api/index.js
@@ -1,14 +1,120 @@
 const express = require('express');
+const jwt = require('jsonwebtoken');
+
+const DEFAULT_PORT = 3001;
+
+function resolveConfig(overrides = {}) {
+  const parsedPort = process.env.PORT ? parseInt(process.env.PORT, 10) : undefined;
+  const envPort = Number.isNaN(parsedPort) ? undefined : parsedPort;
+  const baseConfig = {
+    port: overrides.port ?? envPort ?? DEFAULT_PORT,
+    adminJwtSecret: overrides.adminJwtSecret ?? process.env.ADMIN_JWT_SECRET,
+    adminJwtIssuer: overrides.adminJwtIssuer ?? process.env.ADMIN_JWT_ISSUER ?? 'mega-directory',
+    adminJwtAudience: overrides.adminJwtAudience ?? process.env.ADMIN_JWT_AUDIENCE ?? 'admin',
+    crawlerBearerToken: overrides.crawlerBearerToken ?? process.env.CRAWLER_BEARER_TOKEN
+  };
+
+  const missing = [];
+  if (!baseConfig.adminJwtSecret) {
+    missing.push('ADMIN_JWT_SECRET');
+  }
+  if (!baseConfig.crawlerBearerToken) {
+    missing.push('CRAWLER_BEARER_TOKEN');
+  }
+
+  if (missing.length > 0) {
+    throw new Error(`Missing required config value(s): ${missing.join(', ')}`);
+  }
+
+  return baseConfig;
+}
+
+function createServer(overrides = {}) {
+  const config = resolveConfig(overrides);
+  const app = express();
+
+  app.locals.config = config;
+
+  app.use(express.json());
+
+  app.get('/health', (_req, res) => {
+    res.json({ status: 'ok' });
+  });
+
+  app.get('/v1/admin/ping', requireAdminAuth(config), (_req, res) => {
+    res.json({ status: 'admin-ok' });
+  });
+
+  app.post('/v1/crawler/ping', requireCrawlerToken(config), (_req, res) => {
+    res.json({ status: 'crawler-ok' });
+  });
+
+  return app;
+}
+
+function extractBearerToken(req) {
+  const headerSource =
+    (typeof req.get === 'function' && req.get('authorization')) ||
+    (typeof req.header === 'function' && req.header('authorization')) ||
+    req.headers?.authorization ||
+    req.headers?.Authorization;
+
+  if (!headerSource) {
+    return null;
+  }
+
+  const [scheme, token] = headerSource.split(' ');
+  if (scheme?.toLowerCase() !== 'bearer' || !token) {
+    return null;
+  }
+
+  return token;
+}
+
+function requireAdminAuth(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+
+    try {
+      const payload = jwt.verify(token, config.adminJwtSecret, {
+        issuer: config.adminJwtIssuer,
+        audience: config.adminJwtAudience
+      });
+      req.admin = payload;
+      return next();
+    } catch (err) {
+      return res.status(401).json({ error: 'Admin token missing or invalid' });
+    }
+  };
+}
+
+function requireCrawlerToken(config) {
+  return (req, res, next) => {
+    const token = extractBearerToken(req);
+    if (!token || token !== config.crawlerBearerToken) {
+      return res.status(401).json({ error: 'Crawler token missing or invalid' });
+    }
 
-const app = express();
-const port = process.env.PORT || 3001;
+    return next();
+  };
+}
 
-app.use(express.json());
+function startServer() {
+  const app = createServer();
+  const { port } = app.locals.config ?? { port: DEFAULT_PORT };
 
-app.get('/health', (_req, res) => {
-  res.json({ status: 'ok' });
-});
+  app.listen(port, () => {
+    console.log(`API server running at http://localhost:${port}`);
+  });
+}
 
-app.listen(port, () => {
-  console.log(`API server running at http://localhost:${port}`);
-});
+if (require.main === module) {
+  startServer();
+}
+
+module.exports = {
+  createServer
+};
diff --git a/api/package.json b/api/package.json
index 527f6e8c594c4e000fe1d838c0d9d2545fbe2c7b..791a313e0ab75ac1dd94fdf28ed7b92bf167feae
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
   "main": "index.js",
   "scripts": {
     "dev": "node index.js",
-    "start": "node index.js"
+    "start": "node index.js",
+    "test": "node --test"
   },
   "dependencies": {
-    "express": "^4.19.2"
+    "express": "^4.19.2",
+    "jsonwebtoken": "^9.0.2"
   }
 }
diff --git a/api/test/server.test.js b/api/test/server.test.js
new file mode 100644
index 0000000000000000000000000000000000000000..bafbfc3903bca6f754d711eb4a30ff809c26b7b8
--- /dev/null
+++ b/api/test/server.test.js
@@ -0,0 +1,150 @@
+const test = require('node:test');
+const assert = require('node:assert');
+const jwt = require('jsonwebtoken');
+const { createServer } = require('..');
+
+const baseConfig = Object.freeze({
+  adminJwtSecret: 'test-admin-secret',
+  adminJwtIssuer: 'mega-directory',
+  adminJwtAudience: 'admin',
+  crawlerBearerToken: 'crawler-token'
+});
+
+function findRoute(app, method, path) {
+  const stack = (app._router && app._router.stack) || (app.router && app.router.stack) || [];
+  const methodName = method.toLowerCase();
+  return stack.find(
+    (layer) => layer.route && layer.route.path === path && layer.route.methods[methodName]
+  );
+}
+
+function createRequest({ method = 'GET', headers = {} } = {}) {
+  const normalized = Object.fromEntries(
+    Object.entries(headers).map(([key, value]) => [key.toLowerCase(), value])
+  );
+
+  return {
+    method,
+    headers: normalized,
+    get(name) {
+      return this.headers[name.toLowerCase()];
+    },
+    header(name) {
+      return this.get(name);
+    }
+  };
+}
+
+function createResponse() {
+  return {
+    statusCode: 200,
+    headers: {},
+    body: null,
+    finished: false,
+    status(code) {
+      this.statusCode = code;
+      return this;
+    },
+    json(payload) {
+      this.body = payload;
+      this.finished = true;
+      return this;
+    },
+    set(field, value) {
+      this.headers[field.toLowerCase()] = value;
+      return this;
+    }
+  };
+}
+
+function runRoute(route, req, res) {
+  if (!route) {
+    throw new Error('Route not found');
+  }
+
+  for (const layer of route.route.stack) {
+    let nextCalled = false;
+    const next = () => {
+      nextCalled = true;
+    };
+    layer.handle(req, res, next);
+    if (!nextCalled || res.finished) {
+      break;
+    }
+  }
+
+  return res;
+}
+
+test('health endpoint reports ok', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/health');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'ok' });
+});
+
+test('admin ping rejects missing token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const res = runRoute(route, createRequest(), createResponse());
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Admin token missing or invalid');
+});
+
+test('admin ping accepts valid JWT', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'get', '/v1/admin/ping');
+  const token = jwt.sign(
+    { role: 'admin' },
+    baseConfig.adminJwtSecret,
+    { issuer: baseConfig.adminJwtIssuer, audience: baseConfig.adminJwtAudience, expiresIn: '5m' }
+  );
+
+  const req = createRequest({
+    headers: { Authorization: `Bearer ${token}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'admin-ok' });
+  assert.strictEqual(req.admin.role, 'admin');
+});
+
+test('crawler ping rejects invalid bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const res = runRoute(
+    route,
+    createRequest({ method: 'POST', headers: { Authorization: 'Bearer wrong-token' } }),
+    createResponse()
+  );
+
+  assert.strictEqual(res.statusCode, 401);
+  assert.strictEqual(res.body.error, 'Crawler token missing or invalid');
+});
+
+test('crawler ping accepts matching bearer token', () => {
+  const app = createServer(baseConfig);
+  const route = findRoute(app, 'post', '/v1/crawler/ping');
+  const req = createRequest({
+    method: 'POST',
+    headers: { Authorization: `Bearer ${baseConfig.crawlerBearerToken}` }
+  });
+  const res = runRoute(route, req, createResponse());
+
+  assert.strictEqual(res.statusCode, 200);
+  assert.deepStrictEqual(res.body, { status: 'crawler-ok' });
+});
+
+test('createServer enforces required configuration', () => {
+  assert.throws(() => {
+    createServer({ crawlerBearerToken: 'only-crawler' });
+  }, /Missing required config value/);
+
+  assert.throws(() => {
+    createServer({ adminJwtSecret: 'only-admin' });
+  }, /Missing required config value/);
+});

tokens used
133,500
**API Auth**
- `api/index.js:6` now centralizes config resolution (port defaults + required `ADMIN_JWT_SECRET`/`CRAWLER_BEARER_TOKEN`) so the server refuses to boot without the secrets.
- `api/index.js:32` wires the Express app with JSON parsing, `/health`, and protected `/v1/admin|crawler/ping` routes backed by the new JWT (`requireAdminAuth`) and bearer-token (`requireCrawlerToken`) middleware plus a header-agnostic bearer extractor (`api/index.js:55`).

**Verification**
- Added a lightweight test harness that inspects the Express router stack to simulate requests and assert the auth flows/route responses without opening sockets (`api/test/server.test.js:13`â€“150).
- Package script updated to run the Node test runner and JSON Web Token dependency declared for runtime signing/verification (`api/package.json:6`â€“14).

**Tests**
- `NODE_PATH=/var/home/rick/Development/mega-directory.bku/node_modules npm test` (set `NODE_PATH` because the sandbox canâ€™t hit npm; locally just `npm install && npm test`).

**Next**
- 1) Install dependencies inside `api` (`npm install`) so the new script works without the `NODE_PATH` hack. 2) Provide real `ADMIN_JWT_SECRET`/`CRAWLER_BEARER_TOKEN` env vars before running `npm run dev` or Docker Compose. 3) Start fleshing out real admin/crawler endpoints now that auth plumbing is in place.
