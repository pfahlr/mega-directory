OpenAI Codex v0.57.0 (research preview)
--------
workdir: /var/home/rick/Development/mega-directory
model: gpt-5-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019a77f6-ac40-7c22-b5ed-f441ff9bab9f
--------
user
Implement the functionality described in codex/TASKS/25_define_directory_page_model_and_metadata_fields.yaml, then verify with any available tests.
ERROR: MCP client for `vibe-check-mcp-server` timed out after 10 seconds. Add or adjust `startup_timeout_sec` in your config.toml:
[mcp_servers.vibe-check-mcp-server]
startup_timeout_sec = XX
ERROR: MCP client for `exa` timed out after 10 seconds. Add or adjust `startup_timeout_sec` in your config.toml:
[mcp_servers.exa]
startup_timeout_sec = XX
ERROR: MCP client for `mcp` timed out after 10 seconds. Add or adjust `startup_timeout_sec` in your config.toml:
[mcp_servers.mcp]
startup_timeout_sec = XX

thinking
**Listing repository files for instructions**
exec
bash -lc ls in /var/home/rick/Development/mega-directory succeeded in 43ms:
AGENTS.md
apps
codex
codex.toml
codex.yaml
db
docker-compose.yml
docs
docs.tar
env.json
Makefile
package.json
packages
README.md
scripts
tests
tsconfig.json

thinking
**Opening task definition file**
exec
bash -lc 'cat codex/TASKS/25_define_directory_page_model_and_metadata_fields.yaml' in /var/home/rick/Development/mega-directory succeeded in 39ms:
id: 25
filename: 25_initialize_astro_frontend_with_base_layouts.yaml
title: Initialize Astro Frontend with Base Layouts
description: >
Set up the main Astro-powered frontend application:
    - Install and configure Astro with TypeScript, Tailwind CSS, and necessary integrations
    - Create base layout for pages, with head tags and site-wide styling
    - Implement global header and footer components
    - Create routing system for directory pages (by slug/subdomain)
    - Support both subdomain and subdirectory routing for directory URLs
    - Prepare slots for SEO meta tag injection (meta title, description, og image, etc)
- additional information regarding entire development project this task is part of can be referenced in `codex/TASKS/codex_phase_1b_2.yaml`
dependencies: [24]

thinking
**Investigating task file mismatch**
exec
bash -lc 'ls codex/TASKS' in /var/home/rick/Development/mega-directory succeeded in 44ms:
00_prepare_repository.yaml
01_initialize_astro_frontend.yaml
02_setup_api_server_with_express_and_jwt_auth.yaml
03_design_postgresql_schema.yaml
04_implement_listing_ingestion_api_endpoint.yaml
05_admin_auth_route_and_middleware.yaml
06_frontend_directory_page_rendering.yaml
07_frontend_subcategory_ui_and_layout.yaml
08_setup_featured_listings_logic.yaml
09_add_category_meta_and_seo_controls.yaml
10_scaffold_python_crawler_agent.yaml
11_llm_field_generation_via_jinja2.yaml
12_post_listings_from_crawler_to_api_server.yaml
13_create_json_crawler_configuration_schema.yaml
14_scaffold_admin_ui_application.yaml
15_admin_ui:_listing_review_table.yaml
16_admin_ui:_category_location_approval.yaml
17_admin_ui:_seo_field_editor.yaml
18_deploy_web_+_api_to_railway.yaml
19_setup_logging,_healthchecks_and_monitoring.yaml

thinking
**Opening file to inspect definitions**
exec
bash -lc 'cat codex/TASKS/25_define_directory_page_model_and_metadata_fields.yaml' in /var/home/rick/Development/mega-directory succeeded in 51ms:
id: 25
filename: 25_initialize_astro_frontend_with_base_layouts.yaml
title: Initialize Astro Frontend with Base Layouts
description: >
Set up the main Astro-powered frontend application:
    - Install and configure Astro with TypeScript, Tailwind CSS, and necessary integrations
    - Create base layout for pages, with head tags and site-wide styling
    - Implement global header and footer components
    - Create routing system for directory pages (by slug/subdomain)
    - Support both subdomain and subdirectory routing for directory URLs
    - Prepare slots for SEO meta tag injection (meta title, description, og image, etc)
- additional information regarding entire development project this task is part of can be referenced in `codex/TASKS/codex_phase_1b_2.yaml`
dependencies: [24]

thinking
**Planning Astro frontend implementation**
exec
bash -lc 'ls apps' in /var/home/rick/Development/mega-directory succeeded in 40ms:
admin
api
crawler
web

thinking
**Checking existing Astro setup**
exec
bash -lc 'ls apps/web' in /var/home/rick/Development/mega-directory succeeded in 41ms:
astro.config.mjs
dist
Dockerfile
node_modules
package.json
package-lock.json
postcss.config.cjs
public
README.md
src
tailwind.config.mjs
test
tsconfig.json

thinking
**Reviewing existing Astro setup**
exec
bash -lc 'ls apps/web/src' in /var/home/rick/Development/mega-directory succeeded in 45ms:
components
config
data
layouts
lib
pages
styles

thinking
**Inspecting base layout files**
exec
bash -lc 'ls apps/web/src/layouts' in /var/home/rick/Development/mega-directory succeeded in 40ms:
BaseLayout.astro

thinking
**Viewing file**
exec
bash -lc "sed -n '1,200p' apps/web/src/layouts/BaseLayout.astro" in /var/home/rick/Development/mega-directory succeeded in 40ms:
---
import SiteFooter from '../components/SiteFooter.astro';
import SiteHeader from '../components/SiteHeader.astro';
import { siteConfig } from '../config/site-config.js';
import '../styles/global.css';

const {
  title,
  description,
  navItems,
  showHeader = true,
  showFooter = true,
  seo = {},
} = Astro.props;

const siteName = siteConfig.siteName;
const resolvedTitle = title ?? siteName;
const computedTitle =
  seo.title ??
  (resolvedTitle === siteName ? siteName : `${resolvedTitle} · ${siteName}`);

thinking
**Verifying functionality integration**
exec
bash -lc 'ls apps/web/src/components' in /var/home/rick/Development/mega-directory succeeded in 40ms:
CategoryCard.astro
DirectoryListing.astro
DirectoryPage.astro
HeroSection.astro
ListingItem.astro
SiteFooter.astro
SiteHeader.astro

thinking
**Checking existing Node modules and base layout**
exec
bash -lc "sed -n '1,200p' apps/web/src/components/SiteHeader.astro" in /var/home/rick/Development/mega-directory succeeded in 41ms:
---
interface NavItem {
  label: string;
  href: string;
  ariaLabel?: string;
}

const defaultNav: NavItem[] = [
  { label: 'Listings', href: '#listings' },
  { label: 'Categories', href: '#categories' },
  { label: 'Insights', href: '#insights' },
];

const { navItems = defaultNav } = Astro.props;
---

<header class="relative border-b border-white/10 bg-slate-950/80 text-white shadow-lg shadow-black/20 backdrop-blur supports-[backdrop-filter]:bg-slate-950/60">
  <div class="mx-auto flex max-w-6xl items-center justify-between gap-4 px-4 py-4 sm:px-6 lg:px-8">
    <a
      href="/"

thinking
**Checking existing footer and pages**
exec
bash -lc 'ls apps/web/src/pages' in /var/home/rick/Development/mega-directory succeeded in 43ms:
directories
index.astro

thinking
**Checking directories folder**
exec
bash -lc 'ls apps/web/src/pages/directories' in /var/home/rick/Development/mega-directory succeeded in 39ms:
index.astro
[...path].astro

thinking
**Reviewing dynamic route file**
exec
bash -lc "sed -n '1,200p' apps/web/src/pages/directories/[...path].astro" in /var/home/rick/Development/mega-directory succeeded in 42ms:
---
import DirectoryPage from '../../components/DirectoryPage.astro';
import { directoryCatalog } from '../../data/directory-catalog.js';
import {
  buildDirectoryRouteConfig,
  buildDirectorySubcategories,
  buildSubcategoryFilterNav,
  filterListingsBySubcategory,
  findDirectoryBySlug,
  getDirectorySubdirectorySlug,
  segmentFeaturedListings,
  sortListingsByScore,
} from '../../lib/directory-helpers.js';

export function getStaticPaths() {
  return directoryCatalog.flatMap((directory) => {
    const baseSlug = getDirectorySubdirectorySlug(directory);
    const subcategoryEntries = buildDirectorySubcategories(directory).map((subcategory) => ({
      params: { path: `${baseSlug}/${subcategory.slug}` },
      props: { directorySlug: directory.slug, subcategorySlug: subcategory.slug },

thinking
**Evaluating task implementation and file discrepancies**
exec
bash -lc 'cat codex/TASKS/25a_initialize_astro_frontend_with_base_layouts.yaml' in /var/home/rick/Development/mega-directory succeeded in 40ms:
id: 25
filename: 25_initialize_astro_frontend_with_base_layouts.yaml
title: Initialize Astro Frontend with Base Layouts
description: >
Set up the main Astro-powered frontend application:
- Install and configure Astro with TypeScript, Tailwind CSS, and necessary integrations
- Create base layout for pages, with head tags and site-wide styling
- Implement global header and footer components
- Create routing system for directory pages (by slug/subdomain)
- Support both subdomain and subdirectory routing for directory URLs
- Prepare slots for SEO meta tag injection (meta title, description, og:image, etc)
- additional information regarding entire development project this task is part of can be referenced in `codex/TASKS/codex_phase_1b_2.yaml`
dependencies: [24]

thinking
**Verifying existing routing and subdomain support**
exec
bash -lc 'rg -n "subdomain" -n apps/web/src -g"*.ts" -g"*.js" -g"*.astro"' in /var/home/rick/Development/mega-directory succeeded in 44ms:
apps/web/src/config/site-config.js:13:    subdomainRoot: 'megadirectory.local',
apps/web/src/data/directory-catalog.js:4:    subdomain: 'pros-nyc',
apps/web/src/data/directory-catalog.js:123:    subdomain: 'pros-denver',
apps/web/src/data/directory-catalog.js:207:    subdomain: 'jobs-nyc',
apps/web/src/data/directory-catalog.js:296:    subdomain: 'jobs-sf',
apps/web/src/lib/directory-helpers.js:13:const SUBDOMAIN_ROOT = sanitizeHostname(directoryRouting.subdomainRoot ?? siteConfig.canonicalHost ?? '');
apps/web/src/lib/directory-helpers.js:16:  directoryRouting.primary === 'subdomain' ? 'subdomain' : 'subdirectory';
apps/web/src/lib/directory-helpers.js:136:  const slug = sanitizeHostname(directory?.subdomain);
apps/web/src/lib/directory-helpers.js:152:  const subdomainHost = buildDirectorySubdomainHost(directory);
apps/web/src/lib/directory-helpers.js:153:  const subdomainUrl = subdomainHost ? `${ROUTING_PROTOCOL}://${subdomainHost}` : null;
apps/web/src/lib/directory-helpers.js:155:    PRIMARY_ROUTING_MODE === 'subdomain' && subdomainUrl ? subdomainUrl : `${canonicalBaseUrl}${subdirectory}`;
apps/web/src/lib/directory-helpers.js:159:    subdomainHost,
apps/web/src/lib/directory-helpers.js:160:    subdomainUrl,

thinking
**Inspecting directory-helpers logic**
exec
bash -lc "sed -n '1,260p' apps/web/src/lib/directory-helpers.js" in /var/home/rick/Development/mega-directory succeeded in 43ms:
import { siteConfig } from '../config/site-config.js';

const FALLBACK_SCORE = -Infinity;
const DEFAULT_FEATURED_LIMIT = 3;
const FALLBACK_HERO_LABEL = 'Top pick';
const FALLBACK_TIER_TWO_LABEL = 'Tier-two highlight';
const FEATURED_TIER_ORDER = { HERO: 0, PREMIUM: 1, STANDARD: 2 };
const DEFAULT_DIRECTORY_NAME = 'Mega Directory';
const DEFAULT_CATEGORY_DESCRIPTION_TEMPLATE =
  'Discover curated NAME listings on Mega Directory.';
const directoryRouting = siteConfig.directoryRouting ?? {};
const SUBDIRECTORY_BASE = normalizeBasePath(directoryRouting.subdirectoryBase ?? '/directories');
const SUBDOMAIN_ROOT = sanitizeHostname(directoryRouting.subdomainRoot ?? siteConfig.canonicalHost ?? '');
const ROUTING_PROTOCOL = directoryRouting.protocol ?? 'https';
const PRIMARY_ROUTING_MODE =
  directoryRouting.primary === 'subdomain' ? 'subdomain' : 'subdirectory';

function ensureLeadingSlash(value) {
  if (!value) {
    return '/';

thinking
**Analyzing file purpose and next steps**
exec
bash -lc 'ls apps/web/test' in /var/home/rick/Development/mega-directory succeeded in 40ms:
directory-helpers.test.mjs

thinking
**Checking test coverage**
exec
bash -lc "sed -n '1,200p' apps/web/test/directory-helpers.test.mjs" in /var/home/rick/Development/mega-directory succeeded in 46ms:
import test from 'node:test';
import assert from 'node:assert/strict';
import {
  sortListingsByScore,
  buildDirectoryGroups,
  buildDirectoryPath,
  buildDirectoryPagePath,
  buildDirectoryRouteConfig,
  buildSubcategoryPath,
  buildDirectorySubcategories,
  buildSubcategoryFilterNav,
  filterListingsBySubcategory,
  findDirectoryEntry,
  findDirectoryBySlug,
  findDirectoryBySubdirectory,
  getDirectorySubdirectorySlug,
  segmentFeaturedListings,
  resolveCategorySeoMetadata,
} from '../src/lib/directory-helpers.js';


thinking
**Assessing directory page model task**
exec
bash -lc 'ls db' in /var/home/rick/Development/mega-directory succeeded in 42ms:
migrations
schema.prisma
seed.ts

thinking
**Checking schema.prisma**
exec
bash -lc "sed -n '1,200p' db/schema.prisma" in /var/home/rick/Development/mega-directory succeeded in 51ms:
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ListingStatus {
  PENDING
  APPROVED
  REJECTED
  INACTIVE
}

enum DirectoryStatus {
  DRAFT
  ACTIVE
  ARCHIVED
exec
bash -lc "sed -n '200,400p' db/schema.prisma" in /var/home/rick/Development/mega-directory succeeded in 40ms:
  tier        FeaturedSlotTier
  position    Int              @default(1)
  label       String?
  startsAt    DateTime         @default(now())
  endsAt      DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  directoryId Int
  listingId   Int?

  directory Directory @relation(fields: [directoryId], references: [id])
  listing   Listing?  @relation(fields: [listingId], references: [id])

  @@unique([directoryId, tier, position])
}

model User {
  id             Int        @id @default(autoincrement())
  email          String     @unique
  passwordHash   String

thinking
**Analyzing Directory Model and Task 25 Requirements**

I'm examining whether the current Directory model matches the metadata fields required by Task 25, like hero image and slug, which might be missing or incomplete. I plan to review instructions in `codex/TASKS/codex_phase_1b_2.yaml` and look for any TODOs linked to Task 25 to clarify the exact deliverables and figure out potential gaps or overlaps with Task 27.
exec
bash -lc 'head -n 200 codex/TASKS/codex_phase_1b_2.yaml' in /var/home/rick/Development/mega-directory succeeded in 39ms:
project: mega-directory
version: 1.0
phases:
  - phase: 1
    description: Core system buildout — listings pipeline, directory structure, admin tools, crawler, API, and frontend delivery

    components:
      api_server:
        language: TypeScript
        framework: Node/Express
        deployment: Railway
        endpoints:
          - listings: [GET, POST, PUT, DELETE]
          - addresses: [GET, POST, PUT, DELETE]
          - categories: [GET, POST, PUT, DELETE]
          - directory_pages: [GET, POST, PUT, DELETE]
          - directory_metadata: [GET, PUT]
        notes:
          - Postal, city, state/province, and country tables are loaded from external datasets.
          - Listings reference postal_code_id or city_id depending on geography.

thinking
**Checking for uncommitted changes**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/mega-directory succeeded in 41ms:
## main...origin/main [ahead 2]
 M .env.example
?? .editorconfig
?? .vscode/
?? apps/
?? codex/LOGS/codex_run_2025-11-12_06-13-21.log
?? codex/LOGS/tasklog_24_setup_project_scaffolding_and_configuration_1762946001.log
?? codex/LOGS/tasklog_24_setup_project_scaffolding_and_configuration_1762946001.log.done
?? codex/LOGS/tasklog_25_define_directory_page_model_and_metadata_fields_1762949245.log
?? codex/LOGS/tasklog_25a_initialize_astro_frontend_with_base_layouts_1762948216.log
?? codex/LOGS/tasklog_25a_initialize_astro_frontend_with_base_layouts_1762948216.log.done
?? codex/TASKS/work_list
?? docs.tar
?? docs/codex_tasks_bundle.zip
?? docs/codex_tasks_detailed_final.zip
?? package.json
?? packages/
?? tsconfig.json

thinking
**Assessing untracked app directory**
exec
bash -lc 'cat apps/web/package.json' in /var/home/rick/Development/mega-directory succeeded in 40ms:
{
  "name": "mega-directory-astro",
  "private": true,
  "type": "module",
  "version": "0.0.1",
  "scripts": {
    "dev": "astro dev",
    "start": "astro dev",
    "build": "astro build",
    "preview": "astro preview",
    "test": "node --test ./test/**/*.test.mjs",
    "astro": "astro"
  },
  "dependencies": {
    "astro": "^5.15.5"
  },
  "devDependencies": {
    "@astrojs/tailwind": "^5.1.1",
    "autoprefixer": "^10.4.20",
    "postcss": "^8.4.49",

thinking
**Checking dependencies and config**
exec
bash -lc 'cat apps/web/astro.config.mjs' in /var/home/rick/Development/mega-directory succeeded in 41ms:
// @ts-check
import { defineConfig } from 'astro/config';
import tailwind from '@astrojs/tailwind';

export default defineConfig({
  integrations: [
    tailwind({
      applyBaseStyles: true,
    }),
  ],
});

thinking
**Checking for TypeScript configuration**
exec
bash -lc 'cat apps/web/tsconfig.json' in /var/home/rick/Development/mega-directory succeeded in 40ms:
{
  "extends": "astro/tsconfigs/strict",
  "include": [".astro/types.d.ts", "**/*"],
  "exclude": ["dist"]
}

thinking
**Checking Tailwind configuration file**
exec
bash -lc 'cat apps/web/tailwind.config.mjs' in /var/home/rick/Development/mega-directory succeeded in 41ms:
export default {
  content: ['./src/**/*.{astro,html,js,jsx,md,mdx,svelte,ts,tsx,vue}'],
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        brand: '#34d399',
        surface: '#020617',
        ink: '#e2e8f0',
      },
      borderRadius: {
        '4xl': '2.5rem',
      },
      fontFamily: {
        sans: ['Inter', 'Inter var', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'system-ui', 'sans-serif'],
      },
    },
  },
  plugins: [],
};

thinking
**Checking global styles file**
exec
bash -lc "sed -n '1,200p' apps/web/src/styles/global.css" in /var/home/rick/Development/mega-directory succeeded in 48ms:
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  color-scheme: dark;
  font-family: "Inter", "Inter var", -apple-system, BlinkMacSystemFont, "Segoe UI",
    system-ui, sans-serif;
  --color-bg: #010914;
  --color-bg-muted: #020f21;
  --color-text: #e2e8f0;
  --color-accent: #34d399;
  --color-border: rgba(148, 163, 184, 0.2);
  --radius-lg: 1.5rem;
  text-rendering: optimizeLegibility;
}

*,
*::before,
*::after {

thinking
**Inspecting DirectoryPage component**
exec
bash -lc "sed -n '1,200p' apps/web/src/components/DirectoryPage.astro" in /var/home/rick/Development/mega-directory succeeded in 43ms:
---
import BaseLayout from '../layouts/BaseLayout.astro';
import { resolveCategorySeoMetadata } from '../lib/directory-helpers.js';
import DirectoryListing from './DirectoryListing.astro';

const {
  directory,
  navItems,
  heroStats,
  listings = [],
  totalListings = listings.length,
  subcategoryNav = [],
  featuredHero = null,
  featuredTierTwo = [],
} = Astro.props;

const categorySeo = resolveCategorySeoMetadata(directory?.category ?? {});
const locationName = typeof directory?.location?.name === 'string' ? directory.location.name : '';
const hasExplicitCategoryDescription =
  typeof directory?.category?.metaDescription === 'string' &&

thinking
**Verifying directory page model details**
exec
bash -lc 'nl -ba codex/TASKS/25_define_directory_page_model_and_metadata_fields.yaml' in /var/home/rick/Development/mega-directory succeeded in 41ms:
     1	id: 25
     2	filename: 25_initialize_astro_frontend_with_base_layouts.yaml
     3	title: Initialize Astro Frontend with Base Layouts
     4	description: >
     5	Set up the main Astro-powered frontend application:
     6	    - Install and configure Astro with TypeScript, Tailwind CSS, and necessary integrations
     7	    - Create base layout for pages, with head tags and site-wide styling
     8	    - Implement global header and footer components
     9	    - Create routing system for directory pages (by slug/subdomain)
    10	    - Support both subdomain and subdirectory routing for directory URLs
    11	    - Prepare slots for SEO meta tag injection (meta title, description, og image, etc)
    12	- additional information regarding entire development project this task is part of can be referenced in `codex/TASKS/codex_phase_1b_2.yaml`
    13	dependencies: [24]

thinking
**Verifying feature requirements**
exec
bash -lc "sed -n '1,200p' apps/web/src/data/directory-catalog.js" in /var/home/rick/Development/mega-directory succeeded in 40ms:
export const directoryCatalog = [
  {
    slug: 'professional-services-new-york-city',
    subdomain: 'pros-nyc',
    subdirectory: 'professional-services/new-york-city',
    name: 'NYC Professional Services',
    heroTitle: 'Trusted Pros in New York City',
    heroSubtitle: 'Electricians, HVAC teams, and general contractors with transparent SLAs.',
    category: {
      slug: 'professional-services',
      name: 'Professional Services',
      description: 'Verified operators for commercial and residential work orders.',
      metaTitle: 'Professional Services Directory',
      metaDescription: 'Curated electricians, HVAC crews, and facilities partners.',
    },
    location: {
      slug: 'new-york-city',
      name: 'New York City',
      state: 'NY',
      country: 'US',

thinking
**Assessing routing and test coverage**
exec
bash -lc "sed -n '1,200p' apps/web/src/pages/directories/index.astro" in /var/home/rick/Development/mega-directory succeeded in 43ms:
---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { directoryCatalog } from '../../data/directory-catalog.js';
import { buildDirectoryGroups } from '../../lib/directory-helpers.js';

const groups = buildDirectoryGroups(directoryCatalog);
const totalLocations = groups.reduce((sum, group) => sum + group.locations.length, 0);
const totalListings = groups.reduce((sum, group) => sum + group.totalListings, 0);

const navItems = [
  { href: '#overview', label: 'Overview' },
  { href: '#directories', label: 'Directories' },
];

const heroStats = [
  { label: 'Active categories', value: groups.length },
  { label: 'Locations tracked', value: totalLocations },
  { label: 'Listings scored', value: totalListings },
];
---

thinking
**Verifying task instructions in codebase**
exec
bash -lc 'rg -n "Define directory page" -n codex/TASKS -C 5' in /var/home/rick/Development/mega-directory exited 1 in 48ms:


thinking
**Checking repository setup and task files**
exec
bash -lc 'cat package.json' in /var/home/rick/Development/mega-directory succeeded in 39ms:
{
  "name": "mega-directory",
  "private": true,
  "version": "0.1.0",
  "workspaces": [
    "apps/*",
    "packages/*"
  ],
  "scripts": {
    "test": "npm run test --workspaces --if-present"
  }
}

thinking
**Analyzing routing and test setup**
exec
bash -lc "sed -n '260,520p' apps/web/src/lib/directory-helpers.js" in /var/home/rick/Development/mega-directory succeeded in 47ms:
    let locationEntry = categoryEntry.locations.find(
      (entry) => entry.location.slug === locationSlug,
    );

    if (!locationEntry) {
      locationEntry = {
        location: { ...directory.location, slug: locationSlug },
        directories: [],
        totalListings: 0,
      };
      categoryEntry.locations.push(locationEntry);
    }

    const listingCount = listings.length;
    const averageScore =
      listingCount === 0
        ? 0
        : Number(
            (
              listings.reduce(

thinking
**Evaluating existing functionality and test coverage**
exec
bash -lc "sed -n '1,200p' apps/web/src/pages/index.astro" in /var/home/rick/Development/mega-directory succeeded in 46ms:
---
import BaseLayout from '../layouts/BaseLayout.astro';
import CategoryCard from '../components/CategoryCard.astro';
import HeroSection from '../components/HeroSection.astro';
import ListingItem from '../components/ListingItem.astro';

const featuredListings = [
  {
    link_text: 'Northwind Coffee Roasters',
    uri: 'https://example.com/northwind',
    description_short: 'Solar-powered roastery shipping to 38 states with zero-waste packaging.',
    description_long:
      'Certified organic beans, flexible wholesale programs, and an ADA-compliant tasting room that doubles as a community studio.',
    score: 97,
    badges: ['Carbon neutral', 'Wholesale ready', 'Local pickup'],
    category: 'Food & Beverage',
    location: 'Portland, OR',
    slug: 'northwind-coffee',
  },
  {

thinking
**Evaluating remaining requirements**
exec
bash -lc 'rg -n "metadata" codex/TASKS -n  -g"*.yaml"' in /var/home/rick/Development/mega-directory succeeded in 55ms:
codex/TASKS/codex_phase_1b_2.yaml:17:          - directory_metadata: [GET, PUT]
codex/TASKS/codex_phase_1b_2.yaml:55:          - SEO metadata input (meta_title, description, og:image)
codex/TASKS/39_render_canonical_meta_tags_from_directory_configuration.yaml:5:- Ensure that title, meta description, keywords, and Open Graph metadata are correctly injected into directory pages built with astro SSR
codex/TASKS/31_build_map_widget_for_directory_pages_with_location-aware_listings.yaml:6:- Implement directory rendering logic for listings + metadata display.
codex/TASKS/28_build_admin_ui_for_directory_page_creation_and_editing.yaml:6:- Include fields for category/location linking, subdomain/subdirectory config, and all metadata fields.
codex/TASKS/27_implement_directory_pages_table_and_metadata_fields.yaml:2:filename: 27_implement_directory_pages_table_and_metadata_fields.yaml
codex/TASKS/27_implement_directory_pages_table_and_metadata_fields.yaml:5:- Create the directory_pages table to support manually managed directories with custom SEO metadata.

thinking
**Reviewing additional files for context**
exec
bash -lc 'cat codex/TASKS/27_implement_directory_pages_table_and_metadata_fields.yaml' in /var/home/rick/Development/mega-directory succeeded in 46ms:
id: 27
filename: 27_implement_directory_pages_table_and_metadata_fields.yaml
title: Implement Directory Pages Table and Metadata Fields
description: >
- Create the directory_pages table to support manually managed directories with custom SEO metadata.
- additional information regarding entire development project this task is part of can be referenced in `codex/TASKS/codex_phase_1b_2.yaml`
Include fields: title, meta_keywords, meta_description, og_image_url, subdomain, subdirectory, location_agnostic (bool).
dependencies: []

thinking
**Clarifying task and file references**
exec
bash -lc 'rg -n "define_directory" -n -g"*.yaml" -g"*.md"' in /var/home/rick/Development/mega-directory exited 1 in 49ms:


thinking
**Checking zipped documentation content**
exec
bash -lc 'unzip -l docs/codex_tasks_bundle.zip | head' in /var/home/rick/Development/mega-directory succeeded in 147ms:
Archive:  docs/codex_tasks_bundle.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
      764  11-12-2025 06:03   24_setup_project_scaffolding_and_configuration.yaml
      175  11-12-2025 05:40   25_implement_directory_pages_schema.yaml
      197  11-12-2025 05:40   201_user_account_stub_system.yaml
      172  11-12-2025 05:42   26_placeholder_task.yaml
      172  11-12-2025 05:42   27_placeholder_task.yaml
      172  11-12-2025 05:42   28_placeholder_task.yaml
      172  11-12-2025 05:42   29_placeholder_task.yaml

thinking
**Extracting specific YAML from zip**
exec
bash -lc 'unzip -p docs/codex_tasks_bundle.zip 25_implement_directory_pages_schema.yaml' in /var/home/rick/Development/mega-directory succeeded in 53ms:
id: 25
title: Implement Directory Pages Schema
description: Define DB schema and API support for manually managed directory pages with subdomain/subdirectory routing support.

thinking
**Checking additional zipped documentation**
exec
bash -lc 'unzip -l docs/codex_tasks_detailed_final.zip | head' in /var/home/rick/Development/mega-directory succeeded in 42ms:
Archive:  docs/codex_tasks_detailed_final.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
      460  11-12-2025 05:54   24_setup_project_scaffolding_and_configuration.yaml
      337  11-12-2025 05:54   25_define_directory_page_model_and_metadata_fields.yaml
      310  11-12-2025 05:54   26_implement_directory_page_url_routing_and_subdomain_support.yaml
      185  11-12-2025 05:54   27_add_map_widget_and_listing_pin_features.yaml
      185  11-12-2025 05:54   28_design_country_state_city_postal_schema.yaml
      195  11-12-2025 05:54   29_import_geographic_data_from_external_sources.yaml
      201  11-12-2025 05:54   30_extend_listing_model_with_geographic_references.yaml

thinking
**Extracting specific file from archive**
exec
bash -lc 'unzip -p docs/codex_tasks_detailed_final.zip 25_define_directory_page_model_and_metadata_fields.yaml' in /var/home/rick/Development/mega-directory succeeded in 43ms:
id: 25
title: "Define Directory Page Model and Metadata Fields"
description: >
  Create a new `directory_pages` table in the database with fields for title, meta keywords, meta description, og:image, subdomain, subdirectory, location agnostic flag, and publication status. Allow overrides of SEO values per directory.
dependencies: [24]

thinking
**Analyzing directory_pages table requirements**
exec
bash -lc 'ls apps/api' in /var/home/rick/Development/mega-directory succeeded in 53ms:
dist
Dockerfile
node_modules
package.json
package-lock.json
src
test
tsconfig.json
types

thinking
**Inspecting apps/api/src directory**
exec
bash -lc 'ls apps/api/src' in /var/home/rick/Development/mega-directory succeeded in 43ms:
logger.ts
server.ts

thinking
**Opening server file**
exec
bash -lc "sed -n '1,200p' apps/api/src/server.ts" in /var/home/rick/Development/mega-directory succeeded in 54ms:
import express, { type Express, type Request, type RequestHandler } from 'express';
import jwt, { type JwtPayload } from 'jsonwebtoken';
import { DEFAULT_PORTS, PROJECT_NAME } from '@mega-directory/config';
import { createLogger, createRequestLogger, type Logger } from './logger';

const DEFAULT_PORT = DEFAULT_PORTS.api;
const DEFAULT_LISTING_STATUS: ListingStatus = 'INACTIVE';
const MAX_SLUG_LENGTH = 80;
const DEFAULT_ADMIN_TOKEN_TTL_SECONDS = 60 * 15;

type ListingStatus = 'INACTIVE' | 'ACTIVE';

type NullableString = string | null;

type ListingLocation =
  | {
      addressLine1?: string;
      addressLine2?: string;
      city?: string;
      region?: string;

thinking
**Planning database schema update**
exec
bash -lc 'ls db/migrations' in /var/home/rick/Development/mega-directory succeeded in 44ms:
001_core_schema.sql

thinking
**Verifying content relevance**
exec
bash -lc "sed -n '1,200p' db/migrations/001_core_schema.sql" in /var/home/rick/Development/mega-directory succeeded in 41ms:
-- Core relational schema for Mega Directory
-- Includes directories, listings, categorization, featured slots, users, and LLM configs

CREATE TYPE "ListingStatus" AS ENUM ('PENDING', 'APPROVED', 'REJECTED', 'INACTIVE');
CREATE TYPE "DirectoryStatus" AS ENUM ('DRAFT', 'ACTIVE', 'ARCHIVED');
CREATE TYPE "UserRole" AS ENUM ('ADMIN', 'EDITOR', 'MODERATOR', 'CRAWLER');
CREATE TYPE "UserStatus" AS ENUM ('INVITED', 'ACTIVE', 'SUSPENDED');
CREATE TYPE "FeaturedSlotTier" AS ENUM ('HERO', 'PREMIUM', 'STANDARD');
CREATE TYPE "LlmTargetType" AS ENUM ('LISTING', 'CATEGORY', 'DIRECTORY', 'SUBCATEGORY');

CREATE TABLE "User" (
  "id" SERIAL PRIMARY KEY,
  "email" TEXT NOT NULL UNIQUE,
  "passwordHash" TEXT NOT NULL,
  "displayName" TEXT,
  "role" "UserRole" NOT NULL DEFAULT 'ADMIN',
  "status" "UserStatus" NOT NULL DEFAULT 'INVITED',
  "apiTokenHash" TEXT,
  "lastLoginAt" TIMESTAMPTZ,
  "lastPasswordAt" TIMESTAMPTZ,

thinking
**Planning new directory_pages table implementation**
exec
bash -lc 'rg -n "Directory"' in /var/home/rick/Development/mega-directory succeeded in 363ms:
packages/shared-config/README.md:3:Simple shared constants that are reused by multiple Mega Directory apps. The package intentionally ships as CommonJS so it can be required from Node scripts as well as bundled in Astro.
packages/shared-config/index.js:1:const PROJECT_NAME = 'Mega Directory';
apps/crawler/config/targets.schema.json:4:  "title": "Mega Directory Crawler Configuration",
apps/admin/data/seoEntries.js:8:    metaTitle: 'Electricians Near You | Mega Directory',
apps/admin/data/seoEntries.js:18:    metaTitle: 'Trusted Plumbers | Mega Directory',
apps/admin/data/seoEntries.js:28:    metaTitle: 'Best Electricians in NYC | Mega Directory',
scripts/dev-bootstrap.sh:150:echo "[dev-bootstrap] Booting Mega Directory stack:"
AGENTS.md:3:This document outlines the purpose and operation of each core agent in the **Mega Directory** project architecture.
docs/development_phase_1b.md:7:## Directory Pages
docs/development_phase_1b.md:78:## Directory Pages: Should a directory page be able to display listings across multiple unrelated categories (e.g. "Jobs" and "Real Estate" together)?
apps/admin/index.js:13:app.locals.appName = 'Mega Directory Admin';
db/schema.prisma:17:enum DirectoryStatus {
db/schema.prisma:62:  directories   Directory[]
db/schema.prisma:82:  directories Directory[]
db/schema.prisma:85:model Directory {
db/schema.prisma:95:  status          DirectoryStatus @default(DRAFT)
db/schema.prisma:178:  directory     Directory?           @relation(fields: [directoryId], references: [id])
db/schema.prisma:210:  directory Directory @relation(fields: [directoryId], references: [id])
db/migrations/001_core_schema.sql:1:-- Core relational schema for Mega Directory
db/migrations/001_core_schema.sql:5:CREATE TYPE "DirectoryStatus" AS ENUM ('DRAFT', 'ACTIVE', 'ARCHIVED');

thinking
**Evaluating schema update for directory_pages**
exec
bash -lc "rg -n \"prisma\\.directory\" -n" in /var/home/rick/Development/mega-directory succeeded in 483ms:
db/seed.ts:66:  const nycDirectory = await prisma.directory.upsert({
db/seed.ts:85:  await prisma.directory.upsert({
db/seed.ts:102:  await prisma.directory.upsert({

thinking
**Planning Prisma schema restructuring**
exec
bash -lc 'rg -l "@prisma/client"' in /var/home/rick/Development/mega-directory succeeded in 64ms:
db/seed.ts
codex/LOGS/tasklog_25_define_directory_page_model_and_metadata_fields_1762949245.log
codex/LOGS/tasklog_09_add_category_meta_and_seo_controls_1762856433.log
codex/LOGS/tasklog_08_setup_featured_listings_logic_1762855542.log
codex/LOGS/tasklog_07_frontend_subcategory_ui_and_layout_1762854681.log
codex/LOGS/tasklog_06_frontend_directory_page_rendering_1762853993.log
codex/LOGS/tasklog_03_design_postgresql_schema_1762852701.log
codex/LOGS/tasklog_16_admin_ui:_category_location_approval_1762860436.log

thinking
**Planning DB schema updates and testing**

I'm reviewing how to update the database schema, migration files, and seed scripts with the new SEO-related fields and directory flags. Since testing DB schema changes can be tricky, I’m considering running existing tests for verification and possibly adding targeted tests for directory helper functions later to align with TDD guidelines. Next, I’ll formalize a multi-step plan to update schema, seed data, and run tests.
Plan update
Implementing the directory page model touches the Prisma schema, SQL migration, seed data, and requires validation via tests.
  → Update Prisma schema and SQL migration to add the directory_pages table fields (title, meta keywords, og image, subdirectory, location flag, etc.) per task spec.
  • Refresh seed data and related code to populate new directory page fields.
  • Run and report available test suites to verify changes.

thinking
**Planning schema modifications**
exec
bash -lc 'rg -n "pathPrefix"' in /var/home/rick/Development/mega-directory succeeded in 60ms:
db/migrations/001_core_schema.sql:61:  "pathPrefix" TEXT DEFAULT '/',
db/schema.prisma:91:  pathPrefix      String?         @default("/")
codex/LOGS/tasklog_25_define_directory_page_model_and_metadata_fields_1762949245.log:932:bash -lc 'rg -n "pathPrefix"' in /var/home/rick/Development/mega-directory

thinking
**Updating Directory model schema**
file update
M /var/home/rick/Development/mega-directory/db/schema.prisma
@@ -86,7 +86,7 @@
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
@@ -98,2 +98,5 @@
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
@@ -110,2 +113,3 @@
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
apply_patch(auto_approved=true) exited 0 in 5ms:
Success. Updated the following files:
M db/schema.prisma
file update:
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {

file update:
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Updating database schema and relations for directory_pages**

I'm preparing to rename the Directory table to directory_pages in the migration SQL and update all references in Listing, FeaturedSlot, Category, and Location models to maintain consistency. This includes changing column names like name to title, removing pathPrefix, adjusting foreign keys, unique constraints, and ensuring snake_case with quoted identifiers in SQL. I'll apply patches carefully to the core schema migration file to reflect these updates.
file update
M /var/home/rick/Development/mega-directory/db/migrations/001_core_schema.sql
@@ -54,9 +54,9 @@
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
@@ -68,2 +68,5 @@
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
@@ -73,5 +76,5 @@
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
apply_patch(auto_approved=true) exited 0 in 39ms:
Success. Updated the following files:
M db/migrations/001_core_schema.sql
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..fce5084b9fc88595bde54d565e306982b43fd7f3
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {

file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..fce5084b9fc88595bde54d565e306982b43fd7f3
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Searching for Directory_ references**
exec
bash -lc 'rg -n "Directory" db/migrations/001_core_schema.sql' in /var/home/rick/Development/mega-directory succeeded in 43ms:
1:-- Core relational schema for Mega Directory
5:CREATE TYPE "DirectoryStatus" AS ENUM ('DRAFT', 'ACTIVE', 'ARCHIVED');
65:  "status" "DirectoryStatus" NOT NULL DEFAULT 'DRAFT',
142:  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
171:  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..fce5084b9fc88595bde54d565e306982b43fd7f3
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Updating foreign key constraints and references**
file update
M /var/home/rick/Development/mega-directory/db/migrations/001_core_schema.sql
@@ -141,3 +141,3 @@
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
@@ -170,3 +170,3 @@
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
apply_patch(auto_approved=true) exited 0 in 8ms:
Success. Updated the following files:
M db/migrations/001_core_schema.sql
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {

file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Verifying Directory references usage**
exec
bash -lc 'rg -n "directory_pages" db/migrations/001_core_schema.sql' in /var/home/rick/Development/mega-directory succeeded in 44ms:
55:CREATE TABLE "directory_pages" (
77:  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
78:  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
79:  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
142:  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
171:  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Searching for pathPrefix occurrences**
exec
bash -lc 'rg -n "pathPrefix" -n db/migrations/001_core_schema.sql' in /var/home/rick/Development/mega-directory exited 1 in 42ms:

file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Checking schema and seed updates**
exec
bash -lc "sed -n '1,200p' db/seed.ts" in /var/home/rick/Development/mega-directory succeeded in 40ms:
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  const adminUser = await prisma.user.upsert({
    where: { email: 'admin@example.com' },
    update: {},
    create: {
      email: 'admin@example.com',
      passwordHash: 'placeholder-hash',
      displayName: 'Demo Admin',
      role: 'ADMIN',
      status: 'ACTIVE'
    }
  });

  const servicesCategory = await prisma.category.upsert({
    where: { slug: 'professional-services' },
    update: {},
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Updating seed data for new directory fields**

I’m preparing to enhance the seed script by adding the new fields like `title`, `subdomain`, `subdirectory`, `metaKeywords`, `ogImageUrl`, and `locationAgnostic` to each directory data object. I’ll ensure these are set in both the create and update sections of the upsert to keep the seed idempotent and consistent, especially as some fields are required and non-null. I’ll also consider updating related listings and adjusting the plan to mark Step1 done and Step2 in progress once this update is underway.
Plan update
  ✓ Update Prisma schema and SQL migration to add the directory_pages table fields (title, meta keywords, og image, subdirectory, location flag, etc.) per task spec.
  → Refresh seed data and related code to populate new directory page fields.
  • Run and report available test suites to verify changes.
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Preparing seed file updates**
exec
bash -lc 'rg -n "nycDirectory" -n db/seed.ts' in /var/home/rick/Development/mega-directory succeeded in 45ms:
66:  const nycDirectory = await prisma.directory.upsert({
189:      directoryId: nycDirectory.id
245:      directoryId: nycDirectory.id
287:      directoryId: nycDirectory.id
308:        directoryId: nycDirectory.id,
317:      directoryId: nycDirectory.id,
328:        directoryId: nycDirectory.id,
338:      directoryId: nycDirectory.id,
349:        directoryId: nycDirectory.id,
359:      directoryId: nycDirectory.id,
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {


thinking
**Preparing directory upsert data**
file update
M /var/home/rick/Development/mega-directory/db/seed.ts
@@ -65,52 +65,75 @@
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
apply_patch(auto_approved=true) exited 0 in 8ms:
Success. Updated the following files:
M db/seed.ts
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({

file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Verifying Prisma and TypeScript schema alignment**

I'm carefully checking the compatibility between the TypeScript types and Prisma schema, especially around the `Directory` model updates with fields like `status`, `metaKeywords`, `subdirectory`, and relational IDs. I’m making sure that the `upsert` calls handle relation fields correctly with unchecked inputs and that all references to renamed fields like `name` to `title` are consistent across seeds, schema, and packages. I’m also considering uniqueness constraints and possible shared config updates for SEO overrides. There is a lot here to ensure everything fits smoothly!
exec
bash -lc 'ls packages' in /var/home/rick/Development/mega-directory succeeded in 41ms:
shared-config
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Updating plan after schema check**
Plan update
  ✓ Update Prisma schema and SQL migration to add the directory_pages table fields (title, meta keywords, og image, subdirectory, location flag, etc.) per task spec.
  ✓ Refresh seed data and related code to populate new directory page fields.
  → Run and report available test suites to verify changes.
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Running available tests**
exec
bash -lc 'npm test' in /var/home/rick/Development/mega-directory succeeded in 3.21s:

> mega-directory@0.1.0 test
> npm run test --workspaces --if-present


> mega-directory-admin@0.1.0 test
> node --test

TAP version 13
# Subtest: test/categoryLocationService.test.js
ok 1 - test/categoryLocationService.test.js
  ---
  duration_ms: 166.033898
  type: 'test'
  ...
# Subtest: test/listingsService.test.js
ok 2 - test/listingsService.test.js
  ---
  duration_ms: 162.16532
  type: 'test'
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Marking plan step completion**
Plan update
  ✓ Update Prisma schema and SQL migration to add the directory_pages table fields (title, meta keywords, og image, subdirectory, location flag, etc.) per task spec.
  ✓ Refresh seed data and related code to populate new directory page fields.
  ✓ Run and report available test suites to verify changes.
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Gathering changed files with git status**
exec
bash -lc 'git status -sb' in /var/home/rick/Development/mega-directory succeeded in 99ms:
## main...origin/main [ahead 2]
 M .env.example
 M db/migrations/001_core_schema.sql
 M db/schema.prisma
 M db/seed.ts
?? .editorconfig
?? .vscode/
?? apps/
?? codex/LOGS/codex_run_2025-11-12_06-13-21.log
?? codex/LOGS/tasklog_24_setup_project_scaffolding_and_configuration_1762946001.log
?? codex/LOGS/tasklog_24_setup_project_scaffolding_and_configuration_1762946001.log.done
?? codex/LOGS/tasklog_25_define_directory_page_model_and_metadata_fields_1762949245.log
?? codex/LOGS/tasklog_25a_initialize_astro_frontend_with_base_layouts_1762948216.log
?? codex/LOGS/tasklog_25a_initialize_astro_frontend_with_base_layouts_1762948216.log.done
?? codex/TASKS/work_list
?? docs.tar
?? docs/codex_tasks_bundle.zip
?? docs/codex_tasks_detailed_final.zip
?? package.json
?? packages/
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Preparing detailed modification summary**
exec
bash -lc "nl -ba db/schema.prisma | sed -n '70,150p'" in /var/home/rick/Development/mega-directory succeeded in 42ms:
    70	  state           String?
    71	  country         String?    @default("US")
    72	  timezone        String?
    73	  latitude        Float?
    74	  longitude       Float?
    75	  metaTitle       String?
    76	  metaDescription String?
    77	  isActive        Boolean    @default(true)
    78	  createdAt       DateTime   @default(now())
    79	  updatedAt       DateTime   @updatedAt
    80	
    81	  listings    Listing[]
    82	  directories Directory[]
    83	}
    84	
    85	model Directory {
    86	  id              Int             @id @default(autoincrement())
    87	  title           String
    88	  slug            String          @unique
    89	  subdomain       String          @unique
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Preparing for migration line referencing**
exec
bash -lc "nl -ba db/migrations/001_core_schema.sql | sed -n '50,120p'" in /var/home/rick/Development/mega-directory succeeded in 53ms:
    50	  "isActive" BOOLEAN NOT NULL DEFAULT TRUE,
    51	  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    52	  "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
    53	);
    54	
    55	CREATE TABLE "directory_pages" (
    56	  "id" SERIAL PRIMARY KEY,
    57	  "title" TEXT NOT NULL,
    58	  "slug" TEXT NOT NULL UNIQUE,
    59	  "subdomain" TEXT NOT NULL UNIQUE,
    60	  "subdirectory" TEXT NOT NULL UNIQUE,
    61	  "hostname" TEXT,
    62	  "heroTitle" TEXT,
    63	  "heroSubtitle" TEXT,
    64	  "introMarkdown" TEXT,
    65	  "status" "DirectoryStatus" NOT NULL DEFAULT 'DRAFT',
    66	  "featuredLimit" INTEGER NOT NULL DEFAULT 3,
    67	  "metaTitle" TEXT,
    68	  "metaDescription" TEXT,
    69	  "metaKeywords" TEXT,
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Preparing to update foreign key lines**
exec
bash -lc "nl -ba db/seed.ts | sed -n '50,170p'" in /var/home/rick/Development/mega-directory succeeded in 43ms:
    50	      timezone: 'America/New_York'
    51	    }
    52	  });
    53	
    54	  const sf = await prisma.location.upsert({
    55	    where: { slug: 'san-francisco' },
    56	    update: {},
    57	    create: {
    58	      name: 'San Francisco',
    59	      slug: 'san-francisco',
    60	      state: 'CA',
    61	      country: 'US',
    62	      timezone: 'America/Los_Angeles'
    63	    }
    64	  });
    65	
    66	  const nycDirectoryData = {
    67	    title: 'NYC Professional Services',
    68	    slug: 'professional-services-new-york-city',
    69	    subdomain: 'services.nyc',
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({


thinking
**Summarizing final response format**
codex
**Updates**
- `db/schema.prisma:85` now maps the `Directory` model to the `directory_pages` table and adds the required metadata fields (title, subdirectory, meta keywords, OG image URL, location-agnostic flag) so each directory can provide its own SEO overrides while keeping existing relations intact.
- `db/migrations/001_core_schema.sql:55` mirrors the schema changes by creating the `directory_pages` table with the new columns and updating every foreign-key reference (listings and featured slots) to point at the renamed table.
- `db/seed.ts:66` seeds were refactored to reuse shared directory payloads and now populate the new fields (`title`, `subdirectory`, `metaKeywords`, `ogImageUrl`, `locationAgnostic`) so test data exercises the expanded schema.

**Tests**
- `npm test` (runs admin, API, and Astro workspace suites)
file update:
diff --git a/db/migrations/001_core_schema.sql b/db/migrations/001_core_schema.sql
index e0fcf80323b24849e4d83d3e97afbc546d1f643e..d0c2699cc35846b8442a4e579280bd40cd0ddc1c
--- a/db/migrations/001_core_schema.sql
+++ b/db/migrations/001_core_schema.sql
@@ -52,13 +52,13 @@
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
 );
 
-CREATE TABLE "Directory" (
+CREATE TABLE "directory_pages" (
   "id" SERIAL PRIMARY KEY,
-  "name" TEXT NOT NULL,
+  "title" TEXT NOT NULL,
   "slug" TEXT NOT NULL UNIQUE,
   "subdomain" TEXT NOT NULL UNIQUE,
+  "subdirectory" TEXT NOT NULL UNIQUE,
   "hostname" TEXT,
-  "pathPrefix" TEXT DEFAULT '/',
   "heroTitle" TEXT,
   "heroSubtitle" TEXT,
   "introMarkdown" TEXT,
@@ -66,14 +66,17 @@
   "featuredLimit" INTEGER NOT NULL DEFAULT 3,
   "metaTitle" TEXT,
   "metaDescription" TEXT,
+  "metaKeywords" TEXT,
+  "ogImageUrl" TEXT,
+  "locationAgnostic" BOOLEAN NOT NULL DEFAULT FALSE,
   "isActive" BOOLEAN NOT NULL DEFAULT FALSE,
   "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
   "categoryId" INTEGER NOT NULL,
   "locationId" INTEGER,
-  CONSTRAINT "Directory_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
-  CONSTRAINT "Directory_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
-  CONSTRAINT "Directory_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
+  CONSTRAINT "directory_pages_categoryId_locationId_key" UNIQUE ("categoryId", "locationId"),
+  CONSTRAINT "directory_pages_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "directory_pages_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
 CREATE TABLE "Subcategory" (
@@ -136,7 +139,7 @@
   "approvedById" INTEGER,
   CONSTRAINT "Listing_categoryId_fkey" FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "Listing_locationId_fkey" FOREIGN KEY ("locationId") REFERENCES "Location"("id") ON DELETE SET NULL ON UPDATE CASCADE,
-  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE SET NULL ON UPDATE CASCADE,
+  CONSTRAINT "Listing_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE SET NULL ON UPDATE CASCADE,
   CONSTRAINT "Listing_approvedById_fkey" FOREIGN KEY ("approvedById") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
@@ -165,7 +168,7 @@
   "directoryId" INTEGER NOT NULL,
   "listingId" INTEGER,
   CONSTRAINT "FeaturedSlot_directoryId_tier_position_key" UNIQUE ("directoryId", "tier", "position"),
-  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "Directory"("id") ON DELETE CASCADE ON UPDATE CASCADE,
+  CONSTRAINT "FeaturedSlot_directoryId_fkey" FOREIGN KEY ("directoryId") REFERENCES "directory_pages"("id") ON DELETE CASCADE ON UPDATE CASCADE,
   CONSTRAINT "FeaturedSlot_listingId_fkey" FOREIGN KEY ("listingId") REFERENCES "Listing"("id") ON DELETE SET NULL ON UPDATE CASCADE
 );
 
diff --git a/db/schema.prisma b/db/schema.prisma
index f224077b133b0abe90075e1b2f4c02a7c7e68079..18cebd800fc0895f580da1462fe41886e1d9052f
--- a/db/schema.prisma
+++ b/db/schema.prisma
@@ -84,11 +84,11 @@
 
 model Directory {
   id              Int             @id @default(autoincrement())
-  name            String
+  title           String
   slug            String          @unique
   subdomain       String          @unique
+  subdirectory    String          @unique
   hostname        String?
-  pathPrefix      String?         @default("/")
   heroTitle       String?
   heroSubtitle    String?
   introMarkdown   String?
@@ -96,6 +96,9 @@
   featuredLimit   Int             @default(3)
   metaTitle       String?
   metaDescription String?
+  metaKeywords    String?
+  ogImageUrl      String?
+  locationAgnostic Boolean        @default(false)
   isActive        Boolean         @default(false)
   createdAt       DateTime        @default(now())
   updatedAt       DateTime        @updatedAt
@@ -108,6 +111,7 @@
   featuredSlots FeaturedSlot[]
 
   @@unique([categoryId, locationId])
+  @@map("directory_pages")
 }
 
 model Subcategory {
diff --git a/db/seed.ts b/db/seed.ts
index 1cf8f534378bd907026a5c91f6f1d5abdab04061..c8bae5fcdc721e6801912ea296154c55496f632d
--- a/db/seed.ts
+++ b/db/seed.ts
@@ -63,56 +63,79 @@
     }
   });
 
+  const nycDirectoryData = {
+    title: 'NYC Professional Services',
+    slug: 'professional-services-new-york-city',
+    subdomain: 'services.nyc',
+    subdirectory: 'professional-services/new-york-city',
+    hostname: 'services.nyc.example.com',
+    heroTitle: 'Trusted Pros in New York City',
+    heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
+    status: 'ACTIVE' as const,
+    isActive: true,
+    metaTitle: 'Professional Services in NYC',
+    metaDescription: 'Hand-reviewed professional services in the five boroughs.',
+    metaKeywords: 'electricians,hvac,maintenance,new york',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-nyc.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: nyc.id
+  };
+
   const nycDirectory = await prisma.directory.upsert({
-    where: { slug: 'professional-services-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Professional Services',
-      slug: 'professional-services-new-york-city',
-      subdomain: 'services.nyc',
-      hostname: 'services.nyc.example.com',
-      heroTitle: 'Trusted Pros in New York City',
-      heroSubtitle: 'Browse curated electricians, plumbers, HVAC, and more.',
-      status: 'ACTIVE',
-      isActive: true,
-      metaTitle: 'Professional Services in NYC',
-      metaDescription: 'Hand-reviewed professional services in the five boroughs.',
-      categoryId: servicesCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycDirectoryData.slug },
+    update: nycDirectoryData,
+    create: nycDirectoryData
   });
 
+  const sfDirectoryData = {
+    title: 'SF Professional Services',
+    slug: 'professional-services-san-francisco',
+    subdomain: 'services.sf',
+    subdirectory: 'professional-services/san-francisco',
+    hostname: 'services.sf.example.com',
+    heroTitle: 'Bay Area Specialists',
+    heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'Professional Services in SF',
+    metaDescription: 'Hand-reviewed professional services across the Bay Area.',
+    metaKeywords: 'electricians,hvac,maintenance,san francisco',
+    ogImageUrl: 'https://cdn.example.com/directories/pro-services-sf.png',
+    locationAgnostic: false,
+    categoryId: servicesCategory.id,
+    locationId: sf.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'professional-services-san-francisco' },
-    update: {},
-    create: {
-      name: 'SF Professional Services',
-      slug: 'professional-services-san-francisco',
-      subdomain: 'services.sf',
-      hostname: 'services.sf.example.com',
-      heroTitle: 'Bay Area Specialists',
-      heroSubtitle: 'Top-rated maintainers for your next remodel or repair.',
-      status: 'DRAFT',
-      isActive: false,
-      categoryId: servicesCategory.id,
-      locationId: sf.id
-    }
+    where: { slug: sfDirectoryData.slug },
+    update: sfDirectoryData,
+    create: sfDirectoryData
   });
 
+  const nycJobsDirectoryData = {
+    title: 'NYC Jobs Directory',
+    slug: 'jobs-new-york-city',
+    subdomain: 'jobs.nyc',
+    subdirectory: 'jobs/new-york-city',
+    hostname: 'jobs.nyc.example.com',
+    heroTitle: 'Hiring in NYC',
+    heroSubtitle: 'Recruiting partners for finance, media, and tech.',
+    status: 'DRAFT' as const,
+    isActive: false,
+    metaTitle: 'NYC Jobs & Recruiters',
+    metaDescription: 'Recruiting firms and boards focused on New York City talent.',
+    metaKeywords: 'jobs,recruiting,new york city',
+    ogImageUrl: 'https://cdn.example.com/directories/jobs-nyc.png',
+    locationAgnostic: false,
+    categoryId: jobsCategory.id,
+    locationId: nyc.id
+  };
+
   await prisma.directory.upsert({
-    where: { slug: 'jobs-new-york-city' },
-    update: {},
-    create: {
-      name: 'NYC Jobs Directory',
-      slug: 'jobs-new-york-city',
-      subdomain: 'jobs.nyc',
-      hostname: 'jobs.nyc.example.com',
-      heroTitle: 'Hiring in NYC',
-      heroSubtitle: 'Recruiting partners for finance, media, and tech.',
-      status: 'DRAFT',
-      categoryId: jobsCategory.id,
-      locationId: nyc.id
-    }
+    where: { slug: nycJobsDirectoryData.slug },
+    update: nycJobsDirectoryData,
+    create: nycJobsDirectoryData
   });
 
   const electricalSubcategory = await prisma.subcategory.upsert({

tokens used
174,325
**Updates**
- `db/schema.prisma:85` now maps the `Directory` model to the `directory_pages` table and adds the required metadata fields (title, subdirectory, meta keywords, OG image URL, location-agnostic flag) so each directory can provide its own SEO overrides while keeping existing relations intact.
- `db/migrations/001_core_schema.sql:55` mirrors the schema changes by creating the `directory_pages` table with the new columns and updating every foreign-key reference (listings and featured slots) to point at the renamed table.
- `db/seed.ts:66` seeds were refactored to reuse shared directory payloads and now populate the new fields (`title`, `subdirectory`, `metaKeywords`, `ogImageUrl`, `locationAgnostic`) so test data exercises the expanded schema.

**Tests**
- `npm test` (runs admin, API, and Astro workspace suites)
